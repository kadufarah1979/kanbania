---
id: TASK-0671
title: "Mobile â€” Controle de Reles (toggle cards + WS optimistic update)"
project: aquario
subproject: app-android
sprint: sprint-003
okr: OKR-2026-Q2-11
priority: high
labels: [feature, mobile, hardware]
story_points: 3
created_at: "2026-02-28T14:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: []
blocks: [TASK-0694]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T14:00:00-03:00"
---

## Descricao

Implementar painel de controle de reles em AquariumDetailScreen. Cada rele e exibido como
um card com nome, estado atual (ligado/desligado) e toggle. O estado e atualizado via
WebSocket (tempo real) e com optimistic update ao tocar no toggle.

## Criterios de Aceite

- [ ] Secao "Controles" em AquariumDetailScreen com lista de reles do aquario
- [ ] Cada card: nome do rele, icone, switch on/off, indicador de estado real
- [ ] Toggle chama POST /api/v1/aquariums/{id}/relays/{relayId}/toggle
- [ ] Optimistic update: switch muda imediatamente, reverte se o backend retornar erro
- [ ] Estado atualizado em tempo real via WebSocket (mesmo socket dos parametros)
- [ ] Rele sem resposta do hardware: indicar como "offline" no card

## Notas Tecnicas

- Endpoint: `POST /api/v1/aquariums/{id}/relays/{relayId}/toggle` com body `{ state: bool }`
- WS event: `{ type: 'relay_state', relay_id, state, timestamp }`
- Usar `useMutation` do TanStack Query para o toggle com optimistic update
