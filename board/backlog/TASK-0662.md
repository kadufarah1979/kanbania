---
id: TASK-0662
title: "Mobile — Google Sign-In nativo Android (expo-auth-session + backend OAuth)"
project: aquario
subproject: app-android
sprint: sprint-002
okr: OKR-2026-Q2-11
priority: high
labels: [feature, mobile, auth]
story_points: 5
created_at: "2026-02-28T03:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0658]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T03:00:00-03:00"
---

## Descricao

Implementar o fluxo completo de Google Sign-In no app mobile.
O botao ja existe na LoginScreen (comentado como `TASK-0649 fase 2`),
o backend ja suporta Google OAuth (TASK-0658), e as credenciais ja
estao configuradas no `.env` (`EXPO_PUBLIC_GOOGLE_CLIENT_ID`).

## Criterios de Aceite

- [ ] Botao "Continuar com Google" na LoginScreen chama o fluxo nativo Android
- [ ] Usa `expo-auth-session` + `expo-crypto` para PKCE flow
- [ ] Apos autenticacao Google, envia `id_token` para `POST /api/v1/auth/google`
- [ ] Backend retorna `access_token` + `refresh_token` — armazenados em Zustand/MMKV
- [ ] Fetch do perfil via `GET /api/v1/auth/me` e armazenamento no store
- [ ] Mesmos estados de loading/erro que o login por email
- [ ] Funciona em build debug (APK conectado ao Metro)
- [ ] Botao Google na tela de Cadastro tambem (opcional, mesmo fluxo)

## Contexto Tecnico

- `EXPO_PUBLIC_GOOGLE_CLIENT_ID`: Android Client ID (formato `*.apps.googleusercontent.com`)
- Arquivo de credenciais: `docs/client_secret_*.json` (nao commitar)
- Biblioteca: `expo-auth-session` (ja no SDK 52, sem instalacao adicional)
- Backend endpoint: `POST /api/v1/auth/google` com body `{ id_token: string }`
- app.config.ts precisa do scheme `aquabook` (ja configurado) para redirect URI

## Exemplo de Implementacao

```tsx
import * as Google from 'expo-auth-session/providers/google'

const [request, response, promptAsync] = Google.useAuthRequest({
  androidClientId: process.env.EXPO_PUBLIC_GOOGLE_CLIENT_ID,
})

useEffect(() => {
  if (response?.type === 'success') {
    const { authentication } = response
    // POST authentication.idToken para /api/v1/auth/google
  }
}, [response])
```
