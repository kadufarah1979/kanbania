---
id: TASK-0536
title: "Implementar job semanal de envio da newsletter"
project: aquario
subproject: null
sprint: null
okr: null
priority: medium
labels: [feature, backend]
story_points: 2
created_at: "2026-02-24T00:00:00-03:00"
created_by: claude-code
assigned_to: null
review_requested_from: []
depends_on: [TASK-0534]
blocks: []
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-24T00:00:00-03:00"
---

## Descricao

Criar job Python que roda toda segunda-feira às 08h00 para enviar o digest semanal
de artigos aos subscribers ativos, filtrado pelas preferências de categoria de cada um.

## Criterios de Aceite

- [ ] Job em `backend/app/jobs/newsletter_digest.py`
- [ ] Busca artigos publicados nos últimos 7 dias (status=published)
- [ ] Para cada subscriber ativo, filtra artigos pelas categorias preferidas
- [ ] Se subscriber não tiver categorias definidas (lista vazia), envia todos
- [ ] Não envia e-mail se não houver artigos novos na semana
- [ ] Template HTML do e-mail responsivo com cards de artigo (título, excerpt, link)
- [ ] Rodapé com link de unsubscribe personalizado por token
- [ ] Scheduled via APScheduler ou cron do Docker (segunda-feira 08h00 BRT)
- [ ] Log de envio (quantidade de e-mails enviados, erros) em `activity.jsonl` ou tabela

## Contexto Tecnico

- Reutiliza SMTP configurado no `.env` (`SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASSWORD`)
- Depende de TASK-0534 (model NewsletterSubscriber) e TASK-0553/blog endpoints
- APScheduler já pode estar disponível no projeto — verificar `requirements.txt`
- Template HTML em `backend/app/templates/newsletter_digest.html`
- Ver `docs/public-site.md` seção 5.1

## Notas de Progresso

