---
id: TASK-0685
title: "Mobile â€” Chat B: send message + polling/WS"
project: aquario
subproject: app-android
sprint: sprint-005
okr: OKR-2026-Q2-11
priority: high
labels: [feature, mobile, social]
story_points: 2
created_at: "2026-02-28T14:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0684]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T14:00:00-03:00"
---

## Descricao

Adicionar envio de mensagens ao chat (TASK-0684). Input bar com campo de texto e botao
de enviar. Mensagens novas aparecem em tempo real via WebSocket ou polling curto.

## Criterios de Aceite

- [ ] Input bar no rodape de ConversationDetailScreen
- [ ] POST /api/v1/chat/conversations/{id}/messages com `{ content: string }`
- [ ] Optimistic update: mensagem aparece imediatamente antes do ack do servidor
- [ ] Tempo real: WS event `chat_message` ou polling a cada 3s (fallback)
- [ ] Scroll automatico para a mensagem mais nova ao enviar
- [ ] Desabilitar envio com conteudo vazio; loading state no botao

## Notas Tecnicas

- Preferir WS se o socket de aquario ja estiver aberto
- Senao: polling a cada 3s usando `refetchInterval` do TanStack Query
- Marcar conversa como lida ao abrir: PATCH /api/v1/chat/conversations/{id}/read
