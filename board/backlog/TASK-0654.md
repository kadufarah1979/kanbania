---
id: TASK-0654
title: "Mobile - Investigar tela azul ao reabrir app (splash nao esconde)"
project: aquario
subproject: mobile
sprint: null
okr: null
priority: high
labels: [mobile, bug, splash, expo, android]
story_points: 3
created_at: "2026-02-28T01:55:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: []
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T01:55:00-03:00"
---

## Descricao

Ao fechar o app (background ou kill) e reabrir, a tela azul (splash) fica presa
e o app nao avanca para o conteudo. Ja ocorreu antes (resolvido com
`SplashScreen.preventAutoHideAsync()` + `hideAsync()` em `_layout.tsx`), mas
o problema retornou apos rebuild da TASK-0653.

## Sintoma Observado

- Primeira abertura apos install: funciona normalmente.
- Fechar o app e reabrir: tela azul (#0B1121) permanente, sem transicao.
- Nao ha crash visivel nem RenderError.

## Hipoteses a Investigar

1. **`SplashScreen.hideAsync()` nao esta sendo chamado no re-open**
   - Verificar se o `useEffect` em `_layout.tsx` esta disparando corretamente
     em re-mount apos background/foreground.
   - O `SplashScreen.preventAutoHideAsync()` e chamado no nivel de modulo
     (fora do componente). Em re-opens pode ja ter sido chamado e o estado
     interno do Expo nao resetar, causando `hideAsync()` nunca resolver.

2. **Race condition no `AppState` / `NavigationContainer`**
   - O `NavigationContainer` aguarda o estado de autenticacao (Zustand +
     MMKV). Se o MMKV nao hidrata a tempo, o render trava antes de chamar
     `hideAsync()`.

3. **`expo-splash-screen` exige ser chamado antes do primeiro render**
   - A chamada `SplashScreen.preventAutoHideAsync()` deve estar no nivel
     mais alto possivel. Verificar se esta antes do `registerRootComponent`.

4. **Build debug vs release**
   - Comportamento pode diferir. Testar se ocorre tambem em `expo start`
     (dev server) ou apenas no APK compilado (`expo run:android`).

## Criterios de Aceite

- [ ] App abre normalmente apos ser fechado e reaberto (pelo menos 3x consecutivos)
- [ ] Splash some em todas as situacoes: primeiro open, re-open apos background,
      re-open apos kill do processo
- [ ] Sem regressao no fluxo de autenticacao (redirect para Login se nao logado,
      para Home se logado)

## Contexto Tecnico

- Arquivo principal: `mobile/src/app/_layout.tsx`
- Arquivo de entrada: `mobile/index.js` (verifica se usa `registerRootComponent`)
- Referencia anterior: fix em TASK-0649 adicionou `SplashScreen.hideAsync()`
- Stack: Expo SDK 52, `expo-splash-screen ^0.29`, React Navigation 7
- Dispositivo afetado: Samsung Z Fold 5 (SM-F946B), Android

## Notas de Progresso

_Nenhuma ainda._
