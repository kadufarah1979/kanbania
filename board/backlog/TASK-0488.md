---
id: TASK-0488
title: "Migrar senhas PostgreSQL e MongoDB Docker Compose para Secrets Manager"
project: tecpag
subproject: tecpag-devops
sprint: sprint-066
okr: OKR-2026-Q1-05
priority: critical
labels: [security, devops, infra]
story_points: 3
created_at: "2026-02-23T13:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0483]
blocks: [TASK-0487]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-23T13:00:00-03:00"
---

## Descricao

Atualizar os docker-compose.yml de PostgreSQL e MongoDB para buscar senhas do AWS Secrets Manager
em vez de usar valores hardcoded. Usar Docker secrets ou variaveis de ambiente injetadas
via script de inicializacao que consulta o Secrets Manager.

## Criterios de Aceite

- [ ] `pgsql/docker-compose.yml` sem senha hardcoded — usa variavel de ambiente
- [ ] `mongo/docker-compose.yml` sem senha hardcoded — usa variavel de ambiente
- [ ] Script de inicializacao dos containers busca senha do Secrets Manager e exporta como env var
- [ ] Secrets criados no SM: `tecpag/prd/postgresql` e `tecpag/prd/mongodb`
- [ ] Containers testados com restart e validando que buscam a senha corretamente
- [ ] `grep -r "password\|POSTGRES_PASSWORD\|MONGO_PASSWORD" docker-compose.yml` — sem valores hardcoded

## Contexto Tecnico

- `DevOps/pgsql/pgsql/docker-compose.yml:10`
- `DevOps/mongo/mongo/docker-compose.yml:10`
- Referencia: `scripts/config-aws-cli.sh` para padrao de consulta ao Secrets Manager

## Notas de Progresso

### [2026-02-23 13:00] claude-code
Task criada como parte do roadmap PDR-2026-Q1Q2. Depende de TASK-0483 (novas senhas).
