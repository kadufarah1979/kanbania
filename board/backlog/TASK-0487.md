---
id: TASK-0487
title: "Remover arquivos .env do historico Git (git filter-repo)"
project: tecpag
subproject: tecpag-source
sprint: sprint-066
okr: OKR-2026-Q1-04
priority: critical
labels: [security, devops]
story_points: 3
created_at: "2026-02-23T13:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0485, TASK-0486, TASK-0488, TASK-0489, TASK-0490, TASK-0491, TASK-0492]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-23T13:00:00-03:00"
---

## Descricao

Remover os arquivos `.env` e qualquer outro arquivo com credenciais do historico completo do Git
usando `git filter-repo`. Esta tarefa so deve ser executada APOS todos os secrets terem sido
migrados para o Secrets Manager (todas as dependencias concluidas).

ATENCAO: Esta operacao reescreve o historico Git. Todos os colaboradores devem ser notificados
e re-clonar o repositorio apos o force push.

## Criterios de Aceite

- [ ] `git filter-repo` instalado e executado para remover todos os `.env` do historico
- [ ] Force push realizado em todos os branches relevantes (main, dev, hml, prd)
- [ ] `.gitignore` atualizado para incluir `*.env`, `.env.*`, `*.env.local`
- [ ] Pre-commit hook configurado para bloquear commit de arquivos `.env`
- [ ] `trufflehog` ou `gitleaks` executado no repositorio — zero findings de credenciais
- [ ] Todos os colaboradores notificados e confirmaram re-clone
- [ ] Verificar que nenhum pipeline CI/CD quebrou apos o force push

## Contexto Tecnico

Ferramenta: `pip install git-filter-repo`
Comando base: `git filter-repo --path-glob '*.env' --invert-paths --force`
Alternativa: `git filter-repo --path-glob '**/.env' --invert-paths --force`

Verificacao pre-execucao: listar todos os `.env` no historico:
`git log --all --full-history -- "**/.env" -- "*.env"`

## Notas de Progresso

### [2026-02-23 13:00] claude-code
Task criada como parte do roadmap PDR-2026-Q1Q2.
DEVE ser a ultima task do sprint-066 — depende de todas as migracoes de secrets.
