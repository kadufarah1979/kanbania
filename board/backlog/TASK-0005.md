---
id: TASK-0005
title: "Reescrever locals e modules.tf do HML espelhando DEV"
project: mdm-terraform
sprint: null
okr: null
priority: high
labels: [infra, feature]
story_points: 8
created_at: "2026-02-13T12:00:00-03:00"
created_by: claude-code
assigned_to: null
depends_on: [TASK-0001]
blocks: [TASK-0006]
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-13T12:00:00-03:00"
tokens_used: 10052479
tokens_by_phase:
  backlog: 10052496
---

## Descricao

Reescrever TODOS os arquivos locals_*.tf e o modules.tf do stage/hml/ baseando-se nos
arquivos equivalentes do stage/dev/. Cada arquivo deve ser adaptado com os valores
especificos do ambiente HML.

Esta e a tarefa principal da sprint - todos os servicos, target groups, security groups,
load balancers, ASGs, RDS, MSK, IAM, Route53, S3, Secrets Manager, IoT, etc. devem ser
espelhados do DEV para o HML.

### Arquivos locals_*.tf a criar/reescrever:
- locals_acm.tf - certificados SSL
- locals_asg.tf - Auto Scaling Groups
- locals_ec2.tf - instancias EC2
- locals_eip.tf - Elastic IPs
- locals_iam.tf - roles, policies, users
- locals_iot.tf - IoT Core (AUSENTE no HML atual)
- locals_launch_template.tf - launch templates
- locals_load_balancer.tf - ALB/NLB e target groups
- locals_msk.tf - Kafka cluster
- locals_ngw.tf - NAT Gateway
- locals_rds.tf - banco de dados RDS (AUSENTE no HML atual)
- locals_route53.tf - registros DNS
- locals_s3.tf - buckets S3
- locals_secrets_manager.tf - secrets
- locals_security_group.tf - security groups

### modules.tf:
- Reescrever com todas as chamadas de modulo espelhando DEV

## Criterios de Aceite

- [ ] Todos locals_*.tf presentes no DEV tambem presentes no HML
- [ ] locals_rds.tf criado no HML (ausente atualmente)
- [ ] locals_iot.tf criado no HML (ausente atualmente)
- [ ] Todos valores adaptados para HML (dominio, account, env tag, etc.)
- [ ] modules.tf espelhando DEV com mesmos modulos chamados
- [ ] Health check paths mantidos identicos ao DEV
- [ ] Security group rules espelhando DEV
- [ ] Todos arquivos formatados com terraform fmt
- [ ] Nenhum modulo em modules/ foi alterado

## Contexto Tecnico

- Referencia: `/home/carlosfarah/Projects/IaC/MDM/terraform/stage/dev/locals_*.tf` e `modules.tf`
- Destino: `/home/carlosfarah/Projects/IaC/MDM/terraform/stage/hml/`
- Adaptar: environment tags, dominios (hml.mdm-hub.com.br), nomes de recursos (*-hml-*), etc.
- NAO alterar modules/

## Notas de Progresso
