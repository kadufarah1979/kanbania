---
id: TASK-0509
title: "Configurar drift detection automatizado para ambientes hml e prd"
project: tecpag
subproject: tecpag-iac
sprint: sprint-068
okr: OKR-2026-Q2-09
priority: medium
labels: [infra, devops]
story_points: 2
created_at: "2026-02-23T13:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0499, TASK-0500]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-23T13:00:00-03:00"
---

## Descricao

Configurar execucao automatica de `terraform plan` nos ambientes hml e prd para detectar drift
(divergencias entre estado Terraform e infraestrutura real). Executar em schedule diario via GitLab CI.

## Criterios de Aceite

- [ ] Job `drift-detect` no `.gitlab-ci.yml` rodando diariamente (cron schedule)
- [ ] Cobre ambientes: hml e prd
- [ ] Em caso de drift: cria issue no GitLab automaticamente ou notifica via Slack/email
- [ ] Relatorio de drift salvo como artifact
- [ ] Testado com drift intencional para validar que detecta corretamente

## Contexto Tecnico

Localizacao do pipeline: `IaC/.gitlab-ci.yml`
Comando: `terraform plan -detailed-exitcode` (exit code 2 = drift detectado)
State remoto: S3 + DynamoDB ja configurados

## Notas de Progresso

### [2026-02-23 13:00] claude-code
Depende de TASK-0499 e TASK-0500 (pipeline IaC ativo).
