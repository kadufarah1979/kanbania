---
id: TASK-0422
title: "Firmware - validacao OTA em hardware real (ESP32)"
project: aquario
sprint: sprint-074
okr: OKR-2026-Q2-06
priority: medium
labels: [testing]
story_points: 3
created_at: "2026-02-22T02:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0383]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-22T02:00:00-03:00"
  - agent: "claude-code"
    action: moved_to_backlog
    date: "2026-02-24T12:00:00-03:00"
    note: "Movido para backlog no encerramento da sprint-074. Requer hardware fisico disponivel."
---

## Descricao

Executar teste OTA em hardware real (ESP32) seguindo o procedimento documentado
em `docs/dev/FIRMWARE_OTA_TEST.md`. Validar update normal (v1->v2), verificacao
de checksum SHA256, e rollback automatico em caso de falha.

## Criterios de Aceite

- [ ] ESP32 detecta nova versao via GET /api/v1/firmware/{variant}/latest
- [ ] Download com SHA256 verificado com sucesso (log serial)
- [ ] Flash na particao OTA alternada sem erros
- [ ] Pos-boot: validacao marca firmware como valido em <60s
- [ ] Rollback funciona: firmware com delay >60s reverte para versao anterior
- [ ] Status OTA publicado via MQTT em todas etapas (evidencia mosquitto_sub)
- [ ] Logs/screenshots anexados como evidencia no card

## Contexto Tecnico

Procedimento completo em `docs/dev/FIRMWARE_OTA_TEST.md`.
Requer: ESP32 fisico, backend com S3 configurado, MQTT broker, serial monitor.
Originalmente parte do TASK-0383, extraido por exigir hardware nao disponivel em CI.

## Notas de Progresso
