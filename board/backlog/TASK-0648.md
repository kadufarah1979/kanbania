---
id: TASK-0648
title: "Diagnosticar gargalos e gerar relatorio de performance"
project: innovaq
sprint: sprint-089
okr: null
priority: high
labels:
  - infra
  - research
  - performance
story_points: 3
created_at: "2026-02-27T11:58:00-03:00"
created_by: claude-code
assigned_to: null
depends_on:
  - TASK-0647
blocks:
  - TASK-0649
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-27T11:58:00-03:00"
---

## Descricao

Com base nas metricas coletadas na TASK-0647, analisar os dados e identificar os gargalos reais de performance. Cruzar dados de CloudWatch com a configuracao de infraestrutura (Terraform) para correlacionar causa e efeito.

Pontos de analise:

**EC2 / ASG**
- Instancias t4g com `CPUCreditBalance` zerado ou proximo de zero = throttling
- ASG com `desired_capacity=1` sem scaling policy agressiva o suficiente
- `apiInnovaq` sem ASG (EC2 fixa) — incapaz de escalar sob carga

**ALB**
- `TargetResponseTime` P99 alto indica lentidao na aplicacao ou banco
- Correlacionar picos de `RequestCount` com picos de `CPUUtilization` nas EC2s

**MongoDB**
- `VolumeQueueLength` alto = disco saturado (gargalo de I/O)
- `BurstBalance` zerado em gp2 = IOPS esgotados
- Sem monitoramento nativo de slow queries — avaliar necessidade de CloudWatch Agent

**Configuracoes**
- SSL policy `ELBSecurityPolicy-2016-08` no ALB — avaliar impacto no handshake TLS
- Health check interval de 30s pode mascarar instancias degradadas

## Criterios de Aceite

- [ ] Relatorio gerado em `docs/analise-performance/fase2-diagnostico.md`
- [ ] Cada gargalo identificado com severidade: critico / alto / medio / baixo
- [ ] Correlacoes entre metricas documentadas (ex: CPU alto -> latencia ALB alta)
- [ ] Lista priorizada de melhorias com estimativa de impacto
- [ ] Relatorio revisado e aprovado pelo owner antes de prosseguir para Fase 3

## Contexto Tecnico

- Arquivo de referencia: `docs/analise-performance/fase1-metricas.md` (TASK-0647)
- Terraform PRD: `iac/terraform/stage/prd/`
- Instancias: `bastion` (t4g.micro), `front` (t4g.medium), `apiInnovaq` (t4g.medium), `apiAcl` (t4g.medium), `mongo` (t4g.large), `mongoAcl` (t4g.large)
- ASGs ativos: `front` (min=1, max=3), `apiAcl` (min=1, max=3)
- ASG desabilitado: `apiInnovaq` (EC2 fixa)

## Notas de Progresso

