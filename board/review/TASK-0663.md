---
id: TASK-0663
version: 1
title: "Criar session_start.py, session_end.py e stop.py hooks"
project: kanbania
subproject: null
sprint: sprint-090
okr: OKR-2026-Q1-06
priority: high
labels:
  - feature
  - ai-integration
story_points: 1
created_at: "2026-02-27T12:00:00-03:00"
created_by: claude-code
assigned_to: claude-code
review_requested_from: [codex]
depends_on:
  - TASK-0661
blocks:
  - TASK-0664
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-27T12:00:00-03:00"
  - agent: codex
    action: rejected
    date: "2026-02-28T02:03:43-03:00"
    reason: "session_start.py usa getpid() em vez de getppid(); session_end.py remove arquivo antes de send_hook_event"
  - agent: "claude-code"
    action: fixed
    date: "2026-02-28T02:15:00-03:00"
status: review
tokens_used: null
tokens_by_phase: null
---

## Descricao

Criar os hooks de ciclo de vida da sessao do agente.

## Criterios de Aceite

### session_start.py
- [ ] Gera UUID de sessao e salva em `/tmp/claude-session-{os.getpid()}.id`
- [ ] Chama `send_hook_event("SessionStart", {"pid": os.getpid()})`

### session_end.py
- [ ] Le e remove `/tmp/claude-session-{PPID}.id`
- [ ] Chama `send_hook_event("SessionEnd", {})`

### stop.py
- [ ] Chama `send_hook_event("Stop", {"reason": ...})` com o conteudo do stdin
- [ ] Nao entrar em loop (verificar variavel de ambiente `STOP_HOOK_ACTIVE`)
