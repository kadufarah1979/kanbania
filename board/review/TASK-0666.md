---
id: TASK-0666
version: 1
title: "Implementar handleHookEvent â€” POST /events/hook com persistencia JSONL"
project: kanbania
subproject: kanbania-dashboard
sprint: sprint-090
okr: OKR-2026-Q1-06
priority: high
labels:
  - feature
  - infra
story_points: 2
created_at: "2026-02-27T12:00:00-03:00"
created_by: claude-code
assigned_to: claude-code
review_requested_from: [codex]
depends_on:
  - TASK-0665
blocks:
  - TASK-0667
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-27T12:00:00-03:00"
status: review
tokens_used: null
tokens_by_phase: null
---

## Descricao

Implementar o handler `handleHookEvent` no server.ts que recebe eventos dos hooks
Python, valida, persiste e prepara para broadcast.

## Criterios de Aceite

- [ ] `POST /events/hook` retorna 200 com `{"ok": true}`
- [ ] Validacao: rejeitar (400) se `hook_type` ou `agent_id` ausentes
- [ ] Persistencia: `fs.appendFileSync(HOOKS_LOG, JSON.stringify(event) + "\n")`
- [ ] `HOOKS_LOG` aponta para `${KANBAN_ROOT}/logs/hooks-events.jsonl`
- [ ] Rotacao basica: se arquivo > 10MB, truncar para os ultimos 500 eventos
- [ ] Teste manual: `curl -X POST http://localhost:8766/events/hook -d '{"hook_type":"PreToolUse","agent_id":"claude-code","timestamp":"...","payload":{}}'` retorna 200
