---
id: TASK-0654
title: "Mobile - Investigar tela azul ao reabrir app (splash nao esconde)"
project: aquario
subproject: mobile
sprint: null
okr: null
priority: high
labels: [mobile, bug, splash, expo, android]
story_points: 3
created_at: "2026-02-28T01:55:00-03:00"
created_by: "claude-code"
assigned_to: claude-code
review_requested_from: [codex]
depends_on: []
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T01:55:00-03:00"
  - agent: "claude-code"
    action: implemented
    date: "2026-02-28T02:30:00-03:00"
    notes: "Fix definitivo confirmado em dispositivo fisico (SM-F946B Z Fold 5)."
---

## Descricao

Ao fechar o app (background, kill, force stop, descanso de tela) e reabrir,
a tela azul (#0B1121) ficava permanente e o app nao avanacava para o conteudo.

## Causa Raiz Identificada (Final)

`SplashScreen.preventAutoHideAsync()` registra um `ViewTreeObserver.OnPreDrawListener`
nativo no Android que bloqueia TODOS os desenhos da janela ate `hideAsync()` ser
chamado. No Samsung Z Fold 5 (Android 14), em cold start (force stop, processo
morto por battery optimization), `hideAsync()` falhava silenciosamente — a janela
ficava travada indefinidamente no estado azul.

Tentativas intermediarias (aguardar hidratacao do Zustand, AppState listener,
reducao de timeout) nao resolveram porque o bloqueio era nativo, nao JS.

## Solucao Final

Remover `preventAutoHideAsync()` completamente (`index.js` e `_layout.tsx`).

Sem o bloqueio manual, o Android fecha a splash automaticamente quando o React
desenha o primeiro frame — comportamento padrao do OS que funciona em todos os
cenarios: primeiro open, force stop, descanso de tela, background/foreground.

**Arquivos no estado final:**

`index.js`:
```js
import { registerRootComponent } from 'expo'
import RootLayout from './src/app/_layout'
registerRootComponent(RootLayout)
```

`_layout.tsx`: sem imports nem chamadas de expo-splash-screen.

## Criterios de Aceite

- [x] App abre normalmente apos ser fechado e reaberto
- [x] Splash some em todas as situacoes: primeiro open, re-open apos background,
      re-open apos force stop, retorno do descanso de tela
- [x] Sem regressao no fluxo de autenticacao
- [x] Confirmado em dispositivo fisico Samsung Z Fold 5 (SM-F946B, Android 14)

## Contexto Tecnico

- Arquivos alterados: `mobile/index.js`, `mobile/src/app/_layout.tsx`
- Commit final: `fix(mobile): remove preventAutoHideAsync — splash fecha automaticamente`
- Branch: `task/TASK-0653`
