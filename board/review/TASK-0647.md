---
id: TASK-0647
title: "Coletar metricas CloudWatch do ambiente PRD"
project: innovaq
sprint: sprint-089
okr: null
priority: high
labels:
  - infra
  - research
story_points: 2
created_at: "2026-02-27T11:58:00-03:00"
created_by: claude-code
assigned_to: claude-code
review_requested_from: [codex]
depends_on: []
blocks:
  - TASK-0648
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-27T11:58:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-27T12:00:00-03:00"
  - agent: claude-code
    action: completed
    date: "2026-02-27T12:30:00-03:00"
---

## Descricao

Coletar metricas do CloudWatch das ultimas 2 semanas de todos os recursos do ambiente PRD para embasar o diagnostico de lentidao relatado pelos usuarios.

Recursos a cobrir:

**EC2 (todas as instancias: front, apiInnovaq, apiAcl, mongo, mongoAcl, bastion)**
- `CPUUtilization` — media e P99
- `CPUCreditBalance` e `CPUCreditUsage` (critico para t4g burstable)
- `NetworkIn` / `NetworkOut`
- `StatusCheckFailed`

**ALB (publico e interno)**
- `TargetResponseTime` — media e P99
- `HTTPCode_Target_5XX_Count`
- `HTTPCode_Target_4XX_Count`
- `ActiveConnectionCount`
- `RequestCount`

**EBS (volumes dos Mongos — 300GB cada)**
- `VolumeReadOps` / `VolumeWriteOps`
- `VolumeReadBytes` / `VolumeWriteBytes`
- `VolumeQueueLength`
- `BurstBalance` (se gp2)

## Criterios de Aceite

- [x] Metricas coletadas para todas as EC2s listadas (periodo: ultimas 2 semanas)
- [x] Metricas coletadas para ALB publico e interno
- [x] Metricas coletadas para os 2 volumes EBS dos Mongos
- [x] Dados exportados/documentados em `docs/analise-performance/fase1-metricas.md`
- [x] Identificados periodos de pico e anomalias visiveis nos dados brutos

## Contexto Tecnico

- AWS Profile: `INNOVAQ-PRD` (account: 189958392649)
- Instancias t4g sao burstable — `CPUCreditBalance` zerado significa throttling de CPU
- Volumes EBS: verificar se sao `gp2` (tem BurstBalance) ou `gp3` (IOPS provisionado)
- Periodo sugerido: `2026-02-13` a `2026-02-27` (14 dias)
- Ferramenta: `aws cloudwatch get-metric-statistics` ou `aws cloudwatch get-metric-data`

## Notas de Progresso

- 2026-02-27: Coleta concluida. 8 instancias EC2, 3 LBs, 19 TGs (ALB), 2 volumes EBS analisados.
- Principal achado: mongo CPU sustentada em 56% por 1h em 2026-02-26, correlacionada com pico de 56.6s no front.
- TG-CIELO-50055 com media 7.96s — critico.
- Divergencias entre Terraform e conta real documentadas.
- Relatorio: `docs/analise-performance/fase1-metricas.md`

