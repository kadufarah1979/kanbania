---
id: TASK-0556
title: "Validar endpoints após apply HML"
project: mdm-terraform
subproject: null
sprint: sprint-076
okr: null
priority: high
labels:
  - infra
story_points: 1
created_at: "2026-02-24T00:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on:
  - TASK-0555
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-24T00:00:00-03:00"
---

## Descricao

Após o terraform apply, validar todos os endpoints através da Akamai para garantir que o tráfego está fluindo corretamente na porta 443.

```bash
# Validar endpoints principais via Akamai
curl -v https://api.media.hml.mdm-hub.com.br/health
curl -v https://api.mdm.hml.mdm-hub.com.br/health
curl -v https://api.gateway.hml.mdm-hub.com.br/health
curl -v https://portal.hml.mdm-hub.com.br

# Confirmar que portas antigas não respondem
telnet api.media.hml.mdm-hub.com.br 443   # deve conectar
telnet api.media.hml.mdm-hub.com.br 12170 # deve timeout

# Testar fluxo pelo Kong
curl -v https://api.gateway.hml.mdm-hub.com.br/api-media/health
```

## Criterios de Aceite

- [ ] `https://api.media.hml.mdm-hub.com.br/health` retorna 200
- [ ] `https://api.mdm.hml.mdm-hub.com.br/health` retorna 200
- [ ] `https://api.gateway.hml.mdm-hub.com.br/health` retorna 200
- [ ] `https://portal.hml.mdm-hub.com.br` retorna 200
- [ ] Porta 12170 em `api.media.hml.mdm-hub.com.br` sem resposta (timeout)
- [ ] Porta 12186 em `api.mdm.hml.mdm-hub.com.br` sem resposta (timeout)
- [ ] Porta 8080 em `api.gateway.hml.mdm-hub.com.br` sem resposta (timeout)
- [ ] Fluxo Kong funcional: `https://api.gateway.hml.mdm-hub.com.br/api-media/health` retorna 200
- [ ] Certificado TLS válido em todos os endpoints (sem warning de cert inválido)

## Contexto Tecnico

Validação pós-apply. Depende de TASK-0555 (terraform apply) estar concluída.

Caso algum endpoint falhe:
1. Verificar logs do ALB no CloudWatch
2. Verificar target group health checks
3. Verificar regras host_header no listener 443 (se o hostname bate com o header enviado pelo Akamai)
4. Verificar configuração de origin no Akamai (TASK-0552)

## Notas de Progresso

### [2026-02-24 00:00] claude-code
Card criado. Ultimo card da sprint-076. Depende de TASK-0555.
