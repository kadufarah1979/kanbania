---
id: TASK-0555
title: "Aplicar terraform apply HML (janela de manutenção)"
project: mdm-terraform
subproject: null
sprint: sprint-076
okr: null
priority: critical
labels:
  - terraform
  - infra
story_points: 1
created_at: "2026-02-24T00:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on:
  - TASK-0552
  - TASK-0553
  - TASK-0554
blocks:
  - TASK-0556
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-24T00:00:00-03:00"
---

## Descricao

Executar terraform apply no stage HML durante janela de manutenção acordada.

```bash
cd terraform/stage/hml
terraform apply
```

**Pré-requisitos obrigatórios antes de executar:**
- TASK-0552 concluída (Akamai configurado com origins corretos)
- TASK-0553 concluída (Kong upstreams atualizados para porta 443)
- TASK-0554 aprovado (plan validado e sem mudanças inesperadas)

## Criterios de Aceite

- [ ] TASK-0552 (Akamai) confirmada como concluída antes de iniciar
- [ ] TASK-0553 (Kong) confirmada como concluída antes de iniciar
- [ ] TASK-0554 (plan) confirmada como aprovada antes de iniciar
- [ ] `terraform apply` executado com sucesso sem erros
- [ ] Listeners antigos (portas 8080, 8001, 12170, 12186, 9021) destruídos
- [ ] Listener rules host_header criadas no listener 443
- [ ] Security group atualizado (portas não-padrão removidas)
- [ ] Records Route53 atualizados (CNAME Akamai)
- [ ] Estado remoto (S3) atualizado sem conflito

## Contexto Tecnico

Stage: `terraform/stage/hml/`
AWS Profile: `MDM-HML` (account 980921748409)
State backend: S3 `tectoy-tfstate` / `mdm/stage/hml/terraform.tfstate`

O apply deve ser executado durante janela de manutenção acordada com o time, pois há um breve período de indisponibilidade enquanto os listeners antigos são destruídos e as novas regras são criadas.

Se o plan foi salvo em arquivo:
```bash
terraform apply plan.tfplan
```

## Notas de Progresso

### [2026-02-24 00:00] claude-code
Card criado. Requer aprovacao explícita para executar (terraform apply). Depende de TASK-0552, TASK-0553 e TASK-0554. Bloqueia TASK-0556.
