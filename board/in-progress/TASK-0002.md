---
id: TASK-0002
title: "Executar cleanup_aws.py na conta HML"
project: mdm-terraform
sprint: null
okr: null
priority: high
labels: [infra, devops]
story_points: 3
created_at: "2026-02-13T12:00:00-03:00"
created_by: claude-code
assigned_to: claude-code
depends_on: []
blocks: [TASK-0003]
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-13T12:00:00-03:00"
  - agent: codex
    action: attempted-execution-blocked-network
    date: "2026-02-23T00:00:00-03:00"
  - agent: codex
    action: qa-reproved-moved-to-in-progress
    date: "2026-02-23T21:14:09-03:00"
tokens_used: 10052479
tokens_by_phase:
  backlog: 10052496
---

## Descricao

Executar o script cleanup_aws.py para destruir todos os recursos AWS existentes na conta
HML (980921748409). Este e o passo critico que limpa a conta antes do reprovisionamento.

**ATENCAO**: Operacao destrutiva e irreversivel. Executar com dry-run primeiro para validar.

## Criterios de Aceite

- [ ] Dry-run executado com sucesso e saida revisada
- [ ] VPC e todos recursos associados removidos (EC2, ASG, ALB, NAT GW, subnets, SGs, etc.)
- [ ] Route53 hosted zones limpos
- [ ] S3 buckets esvaziados e removidos
- [ ] Recursos tagueados (IAM, launch templates, etc.) removidos
- [ ] Confirmacao de que a conta HML esta limpa

## Contexto Tecnico

- Script: `/home/carlosfarah/Projects/IaC/MDM/terraform/scripts/cleanup_aws.py`
- Profile: `devops`
- Conta alvo: `980921748409`
- Region: `us-east-1`
- Parametros necessarios: --profile devops --region us-east-1 --vpc-id <VPC_ID> --confirm DELETE
- Opcoes adicionais: --hosted-zone-name hml.mdm-hub.com.br --tag-project MDM --tag-env hml
- Primeiro executar com --dry-run para validar

## Notas de Progresso

- 2026-02-23: Card movido de backlog -> in-progress.
- 2026-02-23: Validacao inicial com `AWS_PROFILE=devops aws sts get-caller-identity` falhou por conectividade (`Could not connect to the endpoint URL: https://oidc.us-east-1.amazonaws.com/token`).
- 2026-02-23: Execucao do script em modo seguro (dry-run) tentou iniciar com:
  `python3 scripts/cleanup_aws.py --non-interactive --account-id 980921748409 --profile devops --region us-east-1 --vpc-id vpc-00000000000000000 --confirm DELETE --dry-run --hosted-zone-name hml.mdm-hub.com.br --tag-project MDM --tag-env hml`
  e bloqueou antes de qualquer delecao com `EndpointConnectionError` / `NameResolutionError` para `oidc.us-east-1.amazonaws.com`.
- 2026-02-23: Nenhuma acao destrutiva foi executada na conta HML a partir deste ambiente por falta de resolucao DNS/conectividade AWS.
- QA (codex) reprovado em 2026-02-23T21:14:09-03:00.
- Pendencias objetivas:
  - `board/review/TASK-0002.md:37` criterio "Dry-run executado com sucesso e saida revisada" permanece nao atendido.
  - `board/review/TASK-0002.md:38` a `:42` criterios de limpeza da conta HML permanecem nao atendidos.
  - `board/review/TASK-0002.md:57` a `:61` evidenciam bloqueio de conectividade; reexecutar em ambiente com DNS/rede AWS funcionais e anexar evidencias de execucao.
  - Reenviar para review somente apos completar o fluxo solicitado (dry-run validado + cleanup efetivo + confirmacao final).
