---
id: TASK-0661
version: 1
title: "Criar _shared.py — modulo utilitario compartilhado dos hooks"
project: kanbania
subproject: kanbania-dashboard
sprint: sprint-090
okr: OKR-2026-Q1-06
priority: high
labels:
  - feature
  - infra
  - ai-integration
story_points: 1
created_at: "2026-02-27T12:00:00-03:00"
created_by: claude-code
assigned_to: claude-code
review_requested_from: [codex]
depends_on: []
blocks:
  - TASK-0662
  - TASK-0663
  - TASK-0664
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-27T12:00:00-03:00"
  - agent: codex
    action: rejected
    date: "2026-02-28T01:40:12-03:00"
status: in-progress
tokens_used: null
tokens_by_phase: null
---

## Descricao

Criar o modulo `.claude/hooks/_shared.py` com a funcao `send_hook_event` que todos os
hooks Python utilizarao para enviar eventos ao server.ts.

## Criterios de Aceite

- [ ] Arquivo `.claude/hooks/_shared.py` criado
- [ ] Funcao `send_hook_event(hook_type: str, payload: dict)` implementada
- [ ] Usa apenas stdlib Python (urllib, json, os, datetime) — zero dependencias externas
- [ ] Lê `HOOK_SERVER_URL` do env (default: `http://localhost:8766`)
- [ ] Lê `CLAUDE_AGENT_ID` do env (default: `claude-code`)
- [ ] Falha silenciosa: excecao no envio nao propaga (try/except com pass)
- [ ] Timeout de 2 segundos na requisicao HTTP
- [ ] Payload enviado inclui: agent_id, session_id, hook_type, timestamp ISO-8601, payload

## Notas Tecnicas

O session_id deve ser lido de `/tmp/claude-session-{PPID}.id` (gerado pelo session_start.py).
Se o arquivo nao existir, usar string vazia.

## Progress Notes

### [2026-02-28 01:40] codex

QA rejeitado.

Pendencias objetivas:
- `projects/kanbania/subprojects/kanbania-dashboard/README.md:16` define o escopo do subprojeto em `dashboard/src/**`; esta task implementa codigo fora desse escopo.
- `projects/kanbania/subprojects/kanbania-dashboard/README.md:22` exclui protocolo/infra do subprojeto; `/.claude/hooks/_shared.py:1` adiciona um hook utilitario na raiz do repositorio, entao a mudanca precisa ser reclassificada para o projeto/subprojeto correto ou movida para o escopo declarado.
