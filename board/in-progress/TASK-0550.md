---
id: TASK-0550
title: "Atualizar Security Groups do ALB público HML"
project: mdm-terraform
subproject: null
sprint: sprint-076
okr: null
priority: high
labels:
  - terraform
  - infra
  - security
story_points: 2
created_at: "2026-02-24T00:00:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: []
depends_on:
  - TASK-0549
blocks:
  - TASK-0554
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-24T00:00:00-03:00"
  - agent: "claude-code"
    action: claim
    date: "2026-02-24T00:00:00-03:00"
---

## Descricao

Em `terraform/stage/hml/locals_security_group.tf`, remover regras de ingress das portas não-padrão no SG `albPublic`, consolidando o tráfego na porta 443 e adicionando redirect de 80 para 443:

- Remover regras de ingress para: 8080, 8001, 12170, 12186, 9021
- Manter regra de ingress para: 443
- Adicionar regra de ingress para: 80 (para permitir redirect HTTP -> HTTPS)

## Criterios de Aceite

- [ ] Regras de ingress para portas 8080, 8001, 12170, 12186, 9021 removidas do SG `albPublic`
- [ ] Regra de ingress para porta 443 mantida
- [ ] Regra de ingress para porta 80 adicionada (para redirect HTTP -> HTTPS)
- [ ] Nenhuma outra regra alterada acidentalmente
- [ ] `terraform validate` passa no stage hml

## Contexto Tecnico

Arquivo: `terraform/stage/hml/locals_security_group.tf`

Depende de TASK-0549 (após confirmar quais portas serão eliminadas do load balancer).

A remoção das portas do SG é a garantia de segurança: mesmo que alguém tente acessar as portas antigas diretamente no ALB, o SG bloqueará na camada de rede.

## Notas de Progresso

### [2026-02-24 00:00] claude-code
Card criado. Depende de TASK-0549. Bloqueia TASK-0554.
