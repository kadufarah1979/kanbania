---
id: TASK-0551
title: "Sincronizar Route53 HML com DNS Akamai no Terraform"
project: mdm-terraform
subproject: null
sprint: sprint-076
okr: null
priority: high
labels:
  - terraform
  - infra
story_points: 2
created_at: "2026-02-24T00:00:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: []
depends_on: []
blocks:
  - TASK-0554
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-24T00:00:00-03:00"
  - agent: "claude-code"
    action: claim
    date: "2026-02-24T00:00:00-03:00"
---

## Descricao

Em `terraform/stage/hml/locals_route53.tf`, mover os registros que já estão apontando para Akamai manualmente (drift) de `records_with_alias` para `records_without_alias` como CNAME apontando para `security-mdm-hub.edgesuite.net`.

Registros candidatos a migrar:
- `api.media` — CNAME security-mdm-hub.edgesuite.net
- `api.mdm` — CNAME security-mdm-hub.edgesuite.net
- `api.gateway` — CNAME security-mdm-hub.edgesuite.net
- `gw` — CNAME security-mdm-hub.edgesuite.net
- `portal` — CNAME security-mdm-hub.edgesuite.net (se já estiver no Akamai)
- `kafka-control-center` — CNAME security-mdm-hub.edgesuite.net (se já estiver no Akamai)

**Obrigatorio**: confirmar quais domínios já estão no Akamai antes de aplicar. Não migrar registros que ainda apontam diretamente para o ALB.

## Criterios de Aceite

- [ ] Lista de domínios já no Akamai confirmada (validar via `dig` ou painel Akamai antes de editar)
- [ ] Registros confirmados como Akamai movidos de `records_with_alias` para `records_without_alias` com CNAME `security-mdm-hub.edgesuite.net`
- [ ] Registros ainda apontando para ALB permanecem como alias sem alteração
- [ ] `terraform validate` passa no stage hml
- [ ] Terraform plan mostra apenas os registros esperados sendo alterados (alias -> CNAME)

## Contexto Tecnico

Arquivo: `terraform/stage/hml/locals_route53.tf`

Um registro alias Route53 aponta para um recurso AWS (ALB). Um registro CNAME é um nome canônico externo. A migração de alias para CNAME representa a mudança de "aponta para ALB diretamente" para "aponta para Akamai que por sua vez aponta para ALB".

Ferramenta de verificação:
```bash
dig api.media.hml.mdm-hub.com.br
# Se retornar edgesuite.net no CNAME chain, já está no Akamai
```

## Notas de Progresso

### [2026-02-24 00:00] claude-code
Card criado. Sem dependência de outros cards Terraform (pode ser feito em paralelo com TASK-0549 e TASK-0550). Bloqueia TASK-0554.
