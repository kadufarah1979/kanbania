---
id: TASK-0531
title: "fix(security): ConsoleAI acessivel sem autenticacao (app.py sem guard)"
project: consoleai
subproject: consoleai-security
sprint: sprint-073
okr: OKR-2026-Q2-08
priority: critical
labels: [security, bugfix, hotfix]
story_points: 1
created_at: "2026-02-24T00:10:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: []
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-24T00:10:00-03:00"
  - agent: "claude-code"
    action: approved
    date: "2026-02-24T00:10:00-03:00"
---

## Descricao

Vulnerabilidade critica de seguranca: `src/app.py` (entry point principal do ConsoleAI em producao) nao possuia nenhuma verificacao de autenticacao. Qualquer visitante podia acessar `console.amazonasinovare.com.br` sem login e operar como admin (via dropdown de selecao de usuario).

## Causa Raiz

`dashboard.py` possuia guard de auth (linhas 54-56), mas `app.py` o entry point real em producao nao tinha. O `main()` ia direto para renderizacao de conteudo.

## Correcao Aplicada

Commit `c147c9a` em `main` do repositorio consoleai:

- Adicionado import: `from auth import check_auth, login_form, persist_session_cookie, render_logout_button`
- Adicionado guard no inicio de `main()`:
  - `if not check_auth(): login_form(); return`
  - `persist_session_cookie()`
  - `render_logout_button()`

## Impacto

- Exposicao: Acesso publico completo ao ConsoleAI (workflow, inventario AWS, auditoria, admin de usuarios)
- Dados expostos: tenants, EC2, load balancers, dominios, auditoria
- Privilegio: Qualquer visitante atuava como Admin ConsoleAI
- Detectado por: Carlos Farah em 2026-02-24

## Notas de Progresso

### [2026-02-24 00:10] claude-code
Vulnerabilidade identificada via inspecao manual. Root cause: app.py sem auth guard. Fix aplicado em src/app.py. Pushed commit c147c9a para main. Deploy via CI/CD GitLab.
