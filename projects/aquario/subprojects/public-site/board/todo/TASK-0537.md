---
id: TASK-0537
title: "Implementar model e endpoints de push subscription"
project: aquario
subproject: public-site
sprint: sprint-075
okr: null
priority: medium
labels: [feature, backend, api, database]
story_points: 2
created_at: "2026-02-24T00:00:00-03:00"
created_by: claude-code
assigned_to: null
review_requested_from: []
depends_on: []
blocks: [TASK-0538]
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-24T00:00:00-03:00"
---

## Descricao

Criar o model `PushSubscription` no backend com migration Alembic, endpoints para
salvar/remover subscriptions e integração com `pywebpush` para envio de notificações
push ao publicar novo artigo no blog.

## Criterios de Aceite

- [ ] Model `PushSubscription` criado em `backend/app/models/`
- [ ] Migration Alembic gerada e aplicável
- [ ] `POST /api/v1/push/subscribe` salva subscription vinculada ao usuário autenticado
- [ ] `DELETE /api/v1/push/unsubscribe` remove subscription do usuário
- [ ] `pywebpush` adicionado ao `requirements.txt`
- [ ] VAPID keys geradas e configuradas via `.env` (`VAPID_PUBLIC_KEY`, `VAPID_PRIVATE_KEY`)
- [ ] Função `send_push_notification(user_ids, title, body, url)` implementada
- [ ] Ao publicar artigo (status muda para `published`), envia push para subscribers com a categoria do artigo
- [ ] Testes pytest para os endpoints

## Contexto Tecnico

- Model em `backend/app/models/push_subscription.py`
- Router em `backend/app/api/v1/push.py`
- Lib: `pywebpush` (pip install pywebpush)
- VAPID keys geradas com `vapid --gen --applicationServerKey` ou `pywebpush --info`
- Ver `docs/public-site.md` seção 5.2

## Notas de Progresso

