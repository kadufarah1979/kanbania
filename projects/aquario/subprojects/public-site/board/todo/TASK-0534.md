---
id: TASK-0534
title: "Implementar model e endpoints de newsletter"
project: aquario
subproject: public-site
sprint: sprint-075
okr: null
priority: medium
labels: [feature, backend, api, database]
story_points: 2
created_at: "2026-02-24T00:00:00-03:00"
created_by: claude-code
assigned_to: null
review_requested_from: []
depends_on: []
blocks: [TASK-0535, TASK-0537]
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-24T00:00:00-03:00"
---

## Descricao

Criar o model `NewsletterSubscriber` no backend com migration Alembic e os endpoints
de inscrição, confirmação (double opt-in) e descadastro da newsletter do site público.

## Criterios de Aceite

- [ ] Model `NewsletterSubscriber` criado em `backend/app/models/`
- [ ] Migration Alembic gerada e aplicável sem erro
- [ ] `POST /api/v1/newsletter/subscribe` salva subscriber com status `pending` e envia e-mail de confirmação
- [ ] `GET /api/v1/newsletter/confirm/{token}` muda status para `active`
- [ ] `GET /api/v1/newsletter/unsubscribe/{token}` muda status para `unsubscribed`
- [ ] Token gerado com `secrets.token_urlsafe(32)`
- [ ] Double opt-in envia e-mail via SMTP já configurado
- [ ] Endpoints públicos (sem autenticação)
- [ ] Testes pytest cobrindo os três endpoints

## Contexto Tecnico

- Model em `backend/app/models/newsletter.py`
- Schema Pydantic em `backend/app/schemas/newsletter.py`
- Router em `backend/app/api/v1/newsletter.py`
- Reutilizar serviço SMTP existente (ver `SMTP_HOST`, `SMTP_USER` no `.env`)
- Campo `categories: list[str]` armazenado como array PostgreSQL
- Ver especificação completa em `docs/public-site.md` seção 5.1

## Notas de Progresso

