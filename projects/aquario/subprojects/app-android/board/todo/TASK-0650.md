---
id: TASK-0650
title: "authStore Zustand + MMKV persist + interceptor Axios auto-refresh"
project: aquario
subproject: app-android
sprint: sprint-001
okr: OKR-2026-Q2-11
priority: high
labels: [feature, mobile]
story_points: 2
created_at: "2026-02-26T00:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0647]
blocks: [TASK-0649]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-26T00:00:00-03:00"
---

## Descricao

Implementar o store de autenticacao com Zustand + MMKV e o cliente Axios com interceptor de auto-refresh de token. Base para todo o sistema de autenticacao do app.

## Criterios de Aceitacao

- [ ] `src/shared/stores/authStore.ts` implementado:
  - State: `accessToken` (memoria, null), `refreshToken` (MMKV persist), `user` (MMKV persist), `role` (MMKV persist)
  - Actions: `setTokens`, `setUser`, `logout`, `clearAll`
  - `logout()` limpa MMKV + queryClient.clear() + reseta navegacao para AuthStack
- [ ] `src/shared/api/apiClient.ts` — instancia Axios com:
  - `baseURL` do `process.env.EXPO_PUBLIC_API_URL`
  - Interceptor request: injeta `Authorization: Bearer <accessToken>`
  - Interceptor response: em 401, chama `POST /auth/refresh`, atualiza tokens, retenta request original
  - Em falha do refresh (token expirado): chama `authStore.logout()`
- [ ] `src/shared/stores/uiStore.ts` base: `themeMode` (light/dark/system), `onboardingCompleted`, `biometricEnabled`
- [ ] MMKV storage key: `'aquabook-auth'`, encryption: nao necessario no MVP
- [ ] Sem circular dependency entre apiClient e authStore (usar getter lazy)

## Notas Tecnicas

- Ref: `mobile/ux/STORES.md` secoes authStore e uiStore
- Ref: `mobile/ux/AUTH_FLOW.md` secao interceptor auto-refresh
- `react-native-mmkv` requer build nativo — confirmar que TASK-0647 configurou EAS dev build
- refreshToken deve ser o unico dado que persiste — accessToken sempre em memoria
- Usar `zustand/middleware` `persist` com custom MMKV storage adapter
