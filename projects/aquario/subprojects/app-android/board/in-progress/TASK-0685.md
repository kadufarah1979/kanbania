---
id: TASK-0685
title: "Mobile — Chat B: send message + polling/WS"
project: aquario
subproject: app-android
sprint: sprint-005
okr: OKR-2026-Q2-11
priority: high
labels: [feature, mobile, social]
story_points: 2
created_at: "2026-02-28T14:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0684]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T14:00:00-03:00"
  - agent: "claude-code"
    action: implemented
    date: "2026-02-28T20:00:00-03:00"
    notes: "Input bar no rodape do ConversationDetailScreen, POST para envio, optimistic update, polling 3s via refetchInterval, PATCH read ao montar, scroll invertido"
  - agent: "codex"
    action: qa_changes_requested
    date: "2026-03-01T00:00:00-03:00"
    notes: "Reprovado em QA. ConversationDetailScreen usa PATCH /read sem body enquanto backend exige POST com message_id; lista invertida recebe dados ja revertidos e posiciona a mensagem mais nova longe do input; paginacao usa cursor/next_cursor mas API expõe page/has_next."
---

## Descricao

Adicionar envio de mensagens ao chat (TASK-0684). Input bar com campo de texto e botao
de enviar. Mensagens novas aparecem em tempo real via WebSocket ou polling curto.

## Criterios de Aceite

- [x] Input bar no rodape de ConversationDetailScreen
- [x] POST /api/v1/chat/conversations/{id}/messages com `{ content: string }`
- [x] Optimistic update: mensagem aparece imediatamente antes do ack do servidor
- [x] Tempo real: polling a cada 3s usando refetchInterval do TanStack Query
- [x] Scroll automatico via FlashList invertida (nova mensagem no topo visual = baixo)
- [x] Desabilitar envio com conteudo vazio; loading state no botao

## Notas Tecnicas

- Polling a cada 3s usando `refetchInterval` do TanStack Query
- Marcar conversa como lida ao abrir: PATCH /api/v1/chat/conversations/{id}/read
