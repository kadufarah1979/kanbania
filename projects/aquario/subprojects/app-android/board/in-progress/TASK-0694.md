---
id: TASK-0694
title: "Mobile â€” Automacao (criar/editar/testar regras de relay)"
project: aquario
subproject: app-android
sprint: sprint-006
okr: OKR-2026-Q2-11
priority: medium
labels: [feature, mobile, hardware, automation]
story_points: 3
created_at: "2026-02-28T14:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0671]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T14:00:00-03:00"
  - agent: "claude-code"
    action: implemented
    date: "2026-02-28T18:00:00-03:00"
  - agent: "codex"
    action: qa_changes_requested
    date: "2026-03-01T00:00:00-03:00"
---

## Descricao

Tela de automacoes: regras "se parametro X > Y entao ligar/desligar relay Z".
Lista de automacoes ativas, criacao via wizard simples, teste manual da regra.

## Criterios de Aceite

- [x] Tela "Automacoes" acessivel em AquariumDetailScreen (botao adicionado)
- [x] Lista de regras com condicao, acao e status (ativa/inativa)
- [x] Wizard de criacao: escolher parametro, operador, threshold, relay alvo, acao
- [x] POST /api/v1/aquariums/{id}/automations para criar
- [x] PATCH para editar (toggle enabled), DELETE para remover com confirmacao
- [x] Botao "Testar Agora": dispara a acao manualmente via POST /test
- [x] Toggle de ativa/inativa por regra com optimistic update

## Notas Tecnicas

- Schema: `{ condition: { parameter, operator, value }, action: { relay_id, state }, enabled }`
- Testar agora: POST /api/v1/aquariums/{id}/automations/{automId}/test
