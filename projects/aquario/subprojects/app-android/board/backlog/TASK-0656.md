---
id: TASK-0656
title: "PlanGate + TrialBanner — conformidade Play Store monetizacao"
project: aquario
subproject: app-android
sprint: null
okr: OKR-2026-Q2-11
priority: critical
labels: [feature, mobile, ux]
story_points: 2
created_at: "2026-02-26T00:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0652]
blocks: [TASK-0655]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-26T00:00:00-03:00"
---

## Descricao

Implementar os componentes de monetizacao conforme a politica Reader App do Google Play. PlanGate bloqueia features premium sem mostrar preco. TrialBanner exibe dias restantes sem mostrar preco.

## Criterios de Aceitacao

- [ ] `src/shared/components/PlanGate.tsx`:
  - Props: `requiredPlan`, `featureName`, `featureDescription`, `children`
  - `hasAccess()`: verifica `user.effective_plan` contra hierarquia de planos
  - Se sem acesso: tela com LockIcon + nome da feature + descricao + botao "Ver planos"
  - Botao: `Linking.openURL('https://aquabook.app/planos')` — NUNCA WebView
  - CTA: "Ver planos" ou "Conhecer o Hobby" — NUNCA "Assinar" nem preco
- [ ] `src/shared/components/TrialBanner.tsx`:
  - Exibe se `user.trial_expires_at` existir e nao expirado
  - Texto: "{N} dias restantes do teste Pro" (ou "Ultimo dia...")
  - Toque: `Linking.openURL('https://aquabook.app/planos')`
  - CrownIcon + ChevronRightIcon, cor `statusWarn`
  - Exibir no topo da tab Home
- [ ] Hierarquia de planos: `['free', 'starter', 'hobby', 'pro', 'store', 'store_premium']`
- [ ] NENHUM preco de plano em qualquer parte do app (verificar em todos os componentes)
- [ ] PlanGate aplicado nas features da tabela em `mobile/ux/MONETIZATION.md`

## Notas Tecnicas

- Ref completa: `mobile/ux/MONETIZATION.md` secoes 4, 5 e 6
- `user.effective_plan` ja retornado pelo `GET /api/v1/auth/me`
- `user.trial_expires_at` ja retornado pelo `GET /api/v1/auth/me`
- Importar `Linking` do `react-native` (nao do expo-linking)
- Violacao das regras Google Play = remocao do app
