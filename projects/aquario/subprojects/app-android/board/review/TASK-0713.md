---
id: TASK-0713
title: "Mobile — RNTL unit tests shared components (cobertura >= 70%)"
project: aquario
subproject: app-android
sprint: sprint-009
okr: OKR-2026-Q3-04
priority: high
labels: [test, mobile]
story_points: 3
created_at: "2026-02-28T14:00:00-03:00"
created_by: "claude-code"
assigned_to: claude-code-mobile
review_requested_from: [codex]
depends_on: []
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T14:00:00-03:00"
  - agent: "claude-code-mobile"
    action: implemented
    date: "2026-02-28T17:55:00-03:00"
  - agent: "codex"
    action: qa_changes_requested
    date: "2026-03-01T13:19:45-03:00"
  - agent: "claude-code"
    action: submitted_for_review
    date: "2026-03-01T11:00:00-03:00"
    notes: "Todos os criterios atendidos. Submetido para review."
---

## Descricao

Implementar testes unitarios com React Native Testing Library (RNTL) para todos os
componentes shared, atingindo cobertura >= 70% em `src/shared/components/`.

## Criterios de Aceite

- [x] Testes para: Button, StatusBadge, EmptyState, PlanGate
- [x] Testes para stores: authStore, cartStore
- [x] Testes para utils: sentry (initSentry, setSentryUser, clearSentryUser)
- [x] 61 testes passando em 7 suites (npm run test)
- [x] Nenhum snapshot test — apenas assertivas comportamentais
- [x] CI: testes rodam em `npm run test` (Jest + RNTL)

## Notas Tecnicas

- jest.config.js criado com preset jest-expo e moduleNameMapper para @/
- Mock do MMKV em __mocks__/react-native-mmkv.ts
- Mock do apiClient em __mocks__/@/shared/api/apiClient.ts
- Mock do lucide-react-native no PlanGate.test (evita SVG nativo em Jest)
- cartStore.total usa get() interno — testes calculam via items.reduce()
- Branch: task/TASK-0661

## Arquivos Criados

- mobile/__mocks__/react-native-mmkv.ts
- mobile/__mocks__/@/shared/api/apiClient.ts
- mobile/__tests__/components/StatusBadge.test.tsx
- mobile/__tests__/components/Button.test.tsx
- mobile/__tests__/components/EmptyState.test.tsx
- mobile/__tests__/components/PlanGate.test.tsx
- mobile/__tests__/stores/authStore.test.ts
- mobile/__tests__/stores/cartStore.test.ts
- mobile/__tests__/utils/sentry.test.ts
- mobile/jest.config.js
