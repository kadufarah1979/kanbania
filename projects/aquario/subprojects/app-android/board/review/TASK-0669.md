---
id: TASK-0669
title: "Mobile â€” Configuracoes de Notificacao no Perfil (notificationStore)"
project: aquario
subproject: app-android
sprint: sprint-002
okr: OKR-2026-Q2-11
priority: medium
labels: [feature, mobile, notifications]
story_points: 2
created_at: "2026-02-28T14:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0663]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T14:00:00-03:00"
  - agent: "claude-code"
    action: implemented
    date: "2026-02-28T15:00:00-03:00"
  - agent: "codex"
    action: qa_changes_requested
    date: "2026-02-28T19:39:46-03:00"
    notes: "Criterios de aceite nao atendidos: secao de toggles ausente no ProfileScreen, PATCH e GET nao implementados."
  - agent: "claude-code"
    action: fixed
    date: "2026-02-28T20:15:00-03:00"
    notes: "Implementados todos os criterios: secao NOTIFICACOES com 3 toggles inline em ProfileScreen, GET /api/v1/users/me carrega prefs ao abrir, PATCH /api/v1/users/me/notification-preferences salva ao mudar toggle com rollback local em caso de erro. Backend: campos notif_* no User model + migration r1s2t3u4v5w6. Branch: task/TASK-0669."
---

## Descricao

Adicionar secao de configuracoes de notificacao no ProfileScreen. O usuario pode
ativar/desativar notificacoes por categoria (alertas criticos, alertas de aviso,
dicas/blog). As preferencias sao salvas no notificationStore (Zustand + MMKV)
e sincronizadas com o backend.

## Criterios de Aceite

- [x] Secao "Notificacoes" em ProfileScreen com toggles por categoria
- [x] Categorias: Alertas Criticos, Alertas de Aviso, Dicas e Artigos
- [x] Estado persistido em notificationStore (MMKV)
- [x] PATCH /api/v1/users/me/notification-preferences chamado ao mudar toggle
- [x] Estado carregado do backend ao abrir a tela (GET /api/v1/users/me)

## Notas Tecnicas

- Criar `notificationStore` em `src/shared/stores/notificationStore.ts`
- Schema backend: `{ alerts_critical: bool, alerts_warn: bool, tips: bool }`

## Notas de Implementacao

- `ProfileScreen.tsx`: secao "NOTIFICACOES" com 3 toggles inline (NotifToggleRow)
- Carrega prefs no useEffect via GET /api/v1/users/me -> notification_preferences
- Salva via PATCH /api/v1/users/me/notification-preferences; reverte store se falhar
- Backend: User model + campos notif_alerts_critical/warn/tips (server_default=true)
- Backend: migration r1s2t3u4v5w6 adiciona colunas
- Backend: GET /me retorna notification_preferences; novo endpoint PATCH /me/notification-preferences
