---
id: TASK-0712
title: "Mobile — Detox E2E: login + cadastro aquario + alerta + checkout"
project: aquario
subproject: app-android
sprint: sprint-009
okr: OKR-2026-Q3-04
priority: high
labels: [test, mobile, e2e]
story_points: 3
created_at: "2026-02-28T14:00:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: [codex]
depends_on: []
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T14:00:00-03:00"
  - agent: "claude-code"
    action: implemented
    date: "2026-02-28T14:30:00-03:00"
  - agent: "claude-code"
    action: moved_to_review
    date: "2026-02-28T14:30:00-03:00"
  - agent: "codex"
    action: qa_changes_requested
    date: "2026-03-01T00:00:00-03:00"
---

## Descricao

Implementar suite de testes E2E com Detox para os fluxos criticos do app:
login por email, cadastro de aquario, receber alerta e fluxo de checkout.

## Criterios de Aceite

- [x] Detox configurado para Android (emulador Pixel_6 API 34)
- [x] Teste: login com email/senha valido → HomeScreen exibida
- [x] Teste: login com credenciais invalidas → mensagem de erro
- [x] Teste: cadastrar aquario → aparece na HomeScreen e AquariumsScreen
- [x] Teste: adicionar produto ao carrinho → badge atualizado → checkout
- [ ] Todos os testes passando em `npm run test:e2e` (requer emulador — nao disponivel em CI)
- [x] CI: job E2E comentado no mobile-ci.yml (requer emulador headless para ativar)

## Notas Tecnicas

- Detox ja listado no package.json como devDependency
- Usar `testEnvironment: 'node'` no jest.config.js para E2E
- Test data: usuario de teste criado via `beforeAll` com API do backend

## Implementacao

- `mobile/.detoxrc.js` — configuracao Detox com emulador Pixel_6_API_34
- `mobile/e2e/jest.config.js` — jest runner para testes E2E
- `mobile/e2e/setup.ts` — setup global (launchApp + reloadReactNative)
- `mobile/e2e/auth.e2e.ts` — testes: onboarding, navegacao login, credenciais invalidas, login bem-sucedido
- `mobile/e2e/aquarium.e2e.ts` — testes: criar aquario, verificar exibicao em home e lista
- `mobile/e2e/marketplace.e2e.ts` — testes: browse marketplace, adicionar ao carrinho, checkout completo
- `package.json` — adicionado `detox ^20.0.0`, `@types/detox ^18.0.0`, script `test:e2e`
- `.github/workflows/mobile-ci.yml` — job E2E comentado (requer emulador macOS)
- Branch: `task/TASK-0661`, commit: `5c0352d`
