---
id: TASK-0716
title: "Mobile — expo-updates OTA (canal production, rollback)"
project: aquario
subproject: app-android
sprint: sprint-009
okr: OKR-2026-Q3-04
priority: medium
labels: [devops, mobile]
story_points: 2
created_at: "2026-02-28T14:00:00-03:00"
created_by: "claude-code"
assigned_to: claude-code
review_requested_from: [codex]
depends_on: []
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-28T14:00:00-03:00"
  - agent: "claude-code"
    action: implemented
    date: "2026-02-28T15:00:00-03:00"
  - agent: "codex"
    action: qa_changes_requested
    date: "2026-03-01T16:05:23-03:00"
---

## Descricao

Configurar expo-updates para atualizacoes OTA (Over The Air) no canal production.
Permite publicar correcoes sem passar pela revisao da Play Store.

## Criterios de Aceite

- [x] `expo-updates` configurado no app.config.ts com `updates.url` do EAS
- [ ] Canal `production` criado no EAS: `eas channel:create production`
- [ ] Branch mapeada: branch `main` → canal `production`
- [x] App verifica atualizacoes ao iniciar (checkForUpdateAsync)
- [x] Dialogo "Atualizar agora?" quando ha update disponivel
- [ ] Rollback: procedimento documentado (publicar build anterior via EAS)
- [ ] `eas update --branch production` funcional

## Notas Tecnicas

- Apenas JS bundle e assets sao atualizaveis via OTA — mudancas nativas precisam de novo build
- Testar em build de preview (nao funciona em Expo Go)

## Implementacao

- `src/shared/hooks/useOTAUpdate.ts` — hook com checkForUpdateAsync + Alert
- `app.config.ts` — updates completo: enabled, fallbackToCacheTimeout, checkAutomatically, runtimeVersion
- `.env.example` — `EXPO_PUBLIC_UPDATES_URL=` adicionado
- `package.json` — `expo-updates@~0.26.0` adicionado
- `src/app/_layout.tsx` — useOTAUpdate() chamado no AppContent
