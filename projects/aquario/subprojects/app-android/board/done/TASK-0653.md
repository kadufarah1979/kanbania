---
id: TASK-0653
title: "Dashboard do aquario — ParameterCards ao vivo, sparklines e alertas ativos"
project: aquario
subproject: app-android
sprint: null
okr: OKR-2026-Q2-11
priority: high
labels: [feature, mobile]
story_points: 3
created_at: "2026-02-26T00:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0652, TASK-0654]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-26T00:00:00-03:00"
  - agent: "claude-code"
    action: claimed
    date: "2026-02-26T10:00:00-03:00"
  - agent: "claude-code"
    action: submitted
    date: "2026-02-26T12:00:00-03:00"
    notes: "Implementado AquariumDetailScreen + ParameterCard + useAquariumWS. Branch task/TASK-0653."
  - agent: "codex"
    action: approved
    date: "2026-02-26T13:00:00-03:00"
    notes: "Todos os criterios atendidos: ParameterCard com props corretos (parameter/value/unit/status/history/label), sparkline CartesianChart+Line altura 32, cores fixas por sensor (temperature=#20B2AA, ph=#34D399, salinity=#60A5FA, tds=#A78BFA, ammonia=#F472B6, nitrate=#FB923C). AquariumDetailScreen com useQuery /aquariums/{id} e /readings/latest, useAquariumWS tempo real, grid 2 colunas, AlertCard alertas ativos, badge Ultima atualizacao offline, SkeletonLoader, RefreshControl. index.ts exporta ParameterCard. UserNavigator rota AquariumDetail presente no AquariumsStack. AquariumsScreen navega para AquariumDetail ao tocar."
  - agent: "claude-code"
    action: enhanced
    date: "2026-02-28T02:15:00-03:00"
    notes: "Melhorias de UX aplicadas apos testes em dispositivo fisico (SM-F946B): (1) titulo dinamico no header via navigation.setOptions; (2) banner colapsavel de alertas com chevron expand/collapse; (3) empty state quando todos parametros offline; (4) indicador WS pulsante (ao vivo/offline); (5) parametros com dado exibidos antes dos offline, opacidade reduzida para cards offline. Correcao de grid 2 colunas usando Dimensions.get ao inves de 48.5% (overflow de 2px no Z Fold 5 fechado). Fix de splash permanente no re-open (TASK-0654): preventAutoHideAsync movido para index.js, hideAsync aguarda hidratacao do Zustand persist."
---

## Descricao

Implementar a tela principal do aquario (HomeScreen / AquariumDetailScreen) com leituras de sensores em tempo real via WebSocket, sparklines de historico 1h e lista de alertas ativos.

## Criterios de Aceitacao

- [x] `AquariumDetailScreen` exibe:
  - Header: nome do aquario + status badge (ok/warn/crit) + temperatura da agua
  - Grid de `ParameterCard` para cada parametro monitorado (temp, tds, ph, etc.)
  - Cada card: valor atual, unidade, sparkline 1h, badge de status
  - Lista de alertas ativos (se houver) — card vermelho acima dos ParameterCards
  - Badge "Ultima atualizacao: X min atras" quando offline
- [x] `ParameterCard` implementado com sparkline Victory Native XL
- [x] Sparklines usando Victory Native XL (CartesianChart + Line)
- [x] Dados em tempo real via `useAquariumWS` (hook criado nesta branch)
- [x] Fallback offline: ultimo valor do cache com timestamp via formatTimeAgo
- [x] Loading state com `SkeletonCard` em grid 2 colunas (6 placeholders)
- [x] Pull-to-refresh via RefreshControl

## Notas Tecnicas

- Branch: task/TASK-0653
- Arquivos criados:
  - mobile/src/shared/hooks/useAquariumWS.ts
  - mobile/src/shared/components/ParameterCard.tsx
  - mobile/src/app/screens/user/AquariumDetailScreen.tsx
- Arquivos modificados:
  - mobile/src/app/screens/user/AquariumsScreen.tsx (lista navegavel)
  - mobile/src/app/navigators/UserNavigator.tsx (rota AquariumDetail adicionada)
  - mobile/src/shared/components/index.ts (export ParameterCard)
- Sensor colors fixos: temperatura=#20B2AA, pH=#34D399, salinidade=#60A5FA, tds=#A78BFA, amonia=#F472B6, nitrato=#FB923C
