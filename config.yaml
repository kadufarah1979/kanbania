# =============================================================================
# config.yaml — Global Kanban System Configuration
# =============================================================================
# This file is committed to the repository and shared with the team.
# Machine-specific paths and secrets go in config.local.yaml (gitignored).
# Run ./setup.sh to generate both files interactively.
# =============================================================================

# System identity
system:
  name: "My Kanban"             # Display name for the dashboard
  language: "en"                 # Template language: en | pt-BR | es

# Owner / primary user
owner:
  name: "yourname"
  timezone: "UTC"                # IANA timezone, e.g. "America/Sao_Paulo"

# =============================================================================
# Agents
# Each agent has a role that defines what board transitions they can perform.
# Roles: implementer | reviewer | both | pm
#
# exec_command: null = manually triggered (IDE/terminal)
#               string = auto-triggered by trigger-agent-*.sh scripts
#               Use {{working_dir}} and {{kanban_root}} as placeholders.
# =============================================================================
agents:
  - id: "claude-code"
    name: "Claude Code"
    provider: "anthropic"         # anthropic | openai | google | human
    role: "implementer"           # implementer | reviewer | both | pm
    color: "#a855f7"              # Hex color shown in dashboard
    exec_command: null            # null = manual trigger
    wip_limit: 2                  # Max cards in-progress simultaneously

  - id: "codex"
    name: "Codex"
    provider: "openai"
    role: "reviewer"
    color: "#22c55e"
    exec_command: "codex exec --full-auto -C {{working_dir}} --add-dir {{kanban_root}}"
    wip_limit: 1

# =============================================================================
# Workflow
# Defines allowed board transitions and automatic triggers.
# If this section is absent, all transitions between any columns are allowed.
# =============================================================================
workflow:
  transitions:
    - from: "backlog"
      to: "todo"
      allowed_roles: ["implementer", "pm", "both"]
      action: "prioritize"

    - from: "todo"
      to: "in-progress"
      allowed_roles: ["implementer", "both"]
      action: "claim"

    - from: "in-progress"
      to: "review"
      allowed_roles: ["implementer", "both"]
      action: "submit_review"
      assign_to_role: "reviewer"

    - from: "review"
      to: "done"
      allowed_roles: ["reviewer", "both"]
      action: "approve"

    - from: "review"
      to: "in-progress"
      allowed_roles: ["reviewer", "both"]
      action: "reject"
      assign_to_role: "implementer"

  # Triggers: actions automatically fired on specific transitions
  triggers:
    - on: "transition"
      to: "review"
      action: "exec_agent"
      target_role: "reviewer"
      prompt_template: "review"

    - on: "transition"
      from: "review"
      to: "in-progress"
      action: "exec_agent"
      target_role: "implementer"
      prompt_template: "fix"

# =============================================================================
# Board columns
# The id field must match the directory name under board/.
# =============================================================================
board:
  columns:
    - id: "backlog"
      name: "Backlog"
      description: "Identified tasks, awaiting prioritization"
    - id: "todo"
      name: "To Do"
      description: "Prioritized for the current sprint"
    - id: "in-progress"
      name: "In Progress"
      description: "Being worked on by an agent"
    - id: "review"
      name: "Review"
      description: "Awaiting QA — gate to done or rejection"
    - id: "done"
      name: "Done"
      description: "Completed and approved"

# =============================================================================
# Projects
# Local paths go in config.local.yaml to avoid committing machine-specific data.
# Gates define test/build commands run before a task can move to review.
# =============================================================================
projects:
  # Example project entry. Copy and adapt for each project.
  # Run: ./setup.sh --add-project <slug>  to create the board directory.
  #
  # my-project:
  #   name: "My Project"
  #   gates:
  #     backend:
  #       detect: ["backend/", "server/", "api/"]
  #       commands:
  #         - name: "tests"
  #           run: "make test"
  #     frontend:
  #       detect: ["frontend/", "src/", "app/"]
  #       commands:
  #         - name: "build"
  #           run: "npm run build"
  #
  # Example project with subprojects.
  # Run: ./setup.sh --add-subproject my-app backend
  #
  # my-app:
  #   name: "My App"
  #   subprojects:
  #     - id: backend
  #       name: "Backend API"
  #     - id: frontend
  #       name: "Frontend"
  #   gates:
  #     api:
  #       detect: ["backend/", "api/"]
  #       commands:
  #         - name: "tests"
  #           run: "make test"

# =============================================================================
# Git integration
# =============================================================================
git:
  commit_prefix: "[KANBAN]"      # Prefix for all kanban board commits
  auto_push: true                 # Push to remote after every board state change

# =============================================================================
# Notifications
# Provider: none (default) | notify-send | slack | webhook | telegram
# Credentials go in config.local.yaml > notifications.settings
# =============================================================================
notifications:
  provider: "none"
  settings: {}                   # Override in config.local.yaml

# =============================================================================
# Sprint settings
# =============================================================================
sprint:
  duration_days: 14
  default_capacity: 21
  naming_pattern: "sprint-NNN"

# =============================================================================
# Task schema
# =============================================================================
priorities:
  - id: "critical"
    name: "Critical"
    order: 1
  - id: "high"
    name: "High"
    order: 2
  - id: "medium"
    name: "Medium"
    order: 3
  - id: "low"
    name: "Low"
    order: 4

story_points:
  allowed: [1, 2, 3, 5, 8, 13]
  max_single_task: 3
  epic_threshold: 5
  max_files_per_task: 5

labels:
  - bug
  - feature
  - refactor
  - docs
  - infra
  - security
  - performance
  - ux
  - research
  - ai-integration
  - testing
  - devops

# =============================================================================
# OKR settings
# =============================================================================
okr:
  max_objectives_per_quarter: 5
  kr_per_objective:
    min: 2
    max: 5

# =============================================================================
# Filesystem paths (relative to KANBAN_ROOT)
# =============================================================================
paths:
  board: "board"
  okrs: "okrs"
  sprints: "sprints"
  projects: "projects"
  templates: "templates"
  logs: "logs"

# =============================================================================
# Subprojects
# Projects that have their own board/sprints/okrs per subproject.
# Structure: projects/<proj>/subprojects/<sub>/{board,sprints,okrs}/
# =============================================================================
subprojects:
  enabled: true
  projects_with_subprojects: []
