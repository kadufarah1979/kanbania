---
id: TASK-0196
title: "Frontend: formulario de leitura manual (test kits)"
project: aquario
sprint: sprint-025
okr: OKR-2026-Q1-01
priority: medium
labels: [frontend, readings, ux]
story_points: 3
created_at: "2026-02-18T18:00:00-03:00"
created_by: claude-code
assigned_to: codex
review_requested_from: [codex]
depends_on: [TASK-0195]
blocks: []
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-18T18:00:00-03:00"
  - agent: codex
    action: update
    date: "2026-02-18T18:44:05-03:00"
  - agent: claude-code
    action: complete
    date: "2026-02-18T19:30:00-03:00"
  - agent: codex
    action: complete
    date: "2026-02-18T19:53:08-03:00"
tokens_used: 1737537
tokens_by_phase:
  backlog: 1553137
  in_progress: 184402
---

## Descricao

Criar pagina /readings/new com formulario para registrar leituras manuais de test kits. Lista parametros habilitados do aquario agrupados por categoria, com inputs numericos, selecao de source (manual/test_kit), campo de notas, e feedback visual de warnings/alertas.

## Criterios de Aceite

- [x] Pagina /readings/new acessivel pela sidebar
- [x] Lista parametros habilitados do aquario ativo agrupados por categoria
- [x] Input numerico por parametro com unidade e placeholder de range ideal
- [x] Selecao de source: "Manual" ou "Test Kit" (com campo opcional test_method)
- [x] Campo de notas (texto livre)
- [x] Submissao envia POST /api/v1/readings/manual
- [x] Exibe warnings retornados pelo backend (badges amarelos/vermelhos)
- [x] Toast de sucesso com contagem de leituras salvas
- [x] Link na sidebar "Leituras" ou similar

## Contexto Tecnico

Frontend: `/home/carlosfarah/Projects/aquario/frontend/`
Doc: `docs/dev/PLANO_IMPLANTACAO.md` secao "Fase 4: Componentes" (reading-form.tsx, reading-source-badge.tsx)

Pagina ja existe em `app/(authenticated)/readings/` â€” verificar se ha algo implementado. Se nao, criar.
Usar shadcn/ui components (Card, Input, Select, Badge, Button).
Labels em pt-BR.

## Notas de Progresso

### [2026-02-18 18:00] claude-code
Card criado para formulario de leitura manual.

### [2026-02-18 19:30] claude-code
Verificacao: implementacao ja existente e completa. Arquivos:
- `frontend/src/app/(authenticated)/readings/new/page.tsx`: Pagina com breadcrumb e ReadingForm
- `frontend/src/components/dashboard/reading-form.tsx`: Formulario completo (610 linhas) com:
  - Fetch de parametros do aquario agrupados por categoria (colapsaveis)
  - Inputs numericos com unidade, placeholder de range, validacao abs_min/abs_max
  - Selecao de fonte (manual/test_kit) com campo test_method
  - Campo de data/hora e notas
  - Submit para POST /readings/manual
  - Tela de sucesso com warnings e alertas disparados
  - Botao "Registrar outra leitura"
- `frontend/src/components/dashboard/reading-source-badge.tsx`: Badge visual de fonte
- `frontend/src/lib/api/readings.ts`: API client com submitManualReadings e tipos
- Sidebar ja tem link "Leitura Manual" (/readings/new)
Build TS sem erros.

### [2026-02-18 18:44] codex
QA reprovado e retornado para in-progress. Motivo: criterio de aceite pede toast de sucesso, mas a implementacao atual apresenta sucesso inline na pagina (sem evidencia de toast).

### [2026-02-18] claude-code
Correcao pos-QA. Adicionado `pushAlertToast` com severity "info" apos submit bem-sucedido em `reading-form.tsx:247-250`. Toast exibe contagem de leituras. Sucesso inline mantido tambem. Corrigido import `Calendar` faltante no sidebar (erro de build pre-existente). Build TS OK. Commit 446feaf. Criterios validados:
- Pagina /readings/new: acessivel via sidebar "Leitura Manual"
- Parametros agrupados por categoria (colapsaveis): `reading-form.tsx` CATEGORY_LABELS
- Input numerico com unidade e range: placeholder com abs_min/abs_max
- Source manual/test_kit: select com campo test_method
- Campo notas: textarea
- Submit POST /readings/manual: `readings.ts:submitManualReadings`
- Warnings: badges amarelos/vermelhos na tela de resultado
- Toast de sucesso: `pushAlertToast` com contagem
- Sidebar: link "Leitura Manual" com icon ClipboardEdit

### [2026-02-18 19:49] codex
Normalizacao de metadados do card em review: timeline corrigida e action padronizada no acted_by.

### [2026-02-18 19:53] codex
QA aprovado. Card finalizado e movido para done.
