---
id: TASK-0252
title: "UI: adicionar gerenciamento de usuarios e associacao de tenants no ConsoleAI"
project: consoleai
sprint: sprint-032
okr: null
priority: high
labels: [frontend, streamlit, rbac]
story_points: 3
created_at: "2026-02-19T11:06:32-03:00"
created_by: codex
assigned_to: codex
review_requested_from: []
depends_on: []
blocks: []
acted_by:
  - agent: codex
    action: created
    date: "2026-02-19T11:06:32-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-19T11:06:32-03:00"
  - agent: codex
    action: update
    date: "2026-02-19T11:14:11-03:00"
  - agent: codex
    action: complete
    date: "2026-02-19T11:14:49-03:00"
tokens_used: 1572873
tokens_by_phase:
  backlog: 1553137
---

## Descricao

Adicionar na UI Streamlit do ConsoleAI uma area administrativa para listar usuarios, criar usuario com papeis (devops/developer/manager) e associar tenants (OUs) no mesmo fluxo.

## Criterios de Aceite

- [x] UI exibe tabela de usuarios com status ativo e vinculos de papeis/tenants.
- [x] Formulario permite criar usuario com selecao multipla de papeis e tenants.
- [x] Formulario permite atualizar papeis/tenants e status ativo de usuario existente.
- [x] Validacoes de erro do servico sao exibidas de forma clara na UI.
- [x] Testes automatizados cobrem helper de montagem dos dados de administracao.

## Contexto Tecnico

A camada `user_service` ja implementa CRUD com regras obrigatorias de role/tenant. A tarefa foca em integrar esse fluxo na Streamlit UI sem alterar regras de autorizacao existentes.

## Notas de Progresso

### [2026-02-19 11:06] codex
Task criada para seguir a sprint com foco em frontend administrativo do ConsoleAI.

### [2026-02-19 11:14] codex
Implementacao concluida:
- `src/app.py`: adicionada aba `Administracao` com permissao restrita a gestor, tabela de usuarios, formulario de criacao e formulario de atualizacao (papeis, tenants e status ativo).
- `src/consoleai/admin_ui.py`: helper para formatacao de labels de tenant e linhas da tabela administrativa.
- `tests/test_admin_ui.py`: cobertura dos helpers de montagem de dados da UI.

Evidencia:
- `env PYTHONPATH=src .venv/bin/python -m unittest -q tests.test_admin_ui tests.test_user_service tests.test_authz`
- Resultado: 16 testes OK.

### [2026-02-19 11:14] codex
QA de gate em review:
- `env PYTHONPATH=src .venv/bin/python -m unittest -q tests.test_admin_ui tests.test_user_service tests.test_workflow_ui`
- Resultado: 14 testes OK. Card aprovado para done.
