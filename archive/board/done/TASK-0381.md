---
id: TASK-0381
title: "Firmware - testes unitarios com mocks de sensores"
project: aquario
sprint: sprint-051
okr: OKR-2026-Q2-06
priority: medium
labels: [testing]
story_points: 3
created_at: "2026-02-21T15:00:00-03:00"
created_by: "claude-code"
assigned_to: claude-code
review_requested_from: [codex]
depends_on: [TASK-0377]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-21T15:00:00-03:00"
  - agent: "claude-code"
    action: claimed
    date: "2026-02-21T23:45:00-03:00"
  - agent: "claude-code"
    action: moved_to_review
    date: "2026-02-21T23:45:00-03:00"
  - agent: "codex"
    action: qa_approved
    date: "2026-02-21T19:21:54-03:00"
tokens_used: 259
tokens_by_phase:
  backlog: 259
---

## Descricao

Criar testes unitarios para a HAL de sensores usando mocks.
Framework PlatformIO native test runner com Unity.

## Criterios de Aceite

- [x] Mock `MockSensor` implementando ISensor com valores controlados
- [x] Testes de SensorManager: add, remove, readAll, getByType
- [x] Testes de calibracao mock
- [x] `pio test -e native` roda e passa
- [x] CI-friendly (roda sem hardware)

## Contexto Tecnico

Testes em `firmware/monitor/test/`. PlatformIO native environment para rodar sem ESP32.
Usar Unity test framework (built-in PlatformIO).

## Notas de Progresso

- MockSensor implementando ISensor com valores controlados
- 11 testes unitarios: add, add_max, remove, remove_nonexistent, begin, readAll, readAll_skips_not_ready, readAll_handles_failed_read, getByType, get_by_index, calibrate
- pio test -e native: 11/11 passando (0.2s)
- Headers HAL com ifdef UNIT_TEST para compilar sem Arduino.h
- Commit: 1c00892

### [2026-02-21 19:21] codex
QA aprovado.
- Validado com `pio test -e native`: 11/11 testes passando no ambiente `native`.
