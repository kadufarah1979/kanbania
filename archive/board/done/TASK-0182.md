---
id: TASK-0182
title: "Validar E2E QR -> claim -> approve -> MQTT + runbook operacional"
project: aquario
sprint: sprint-022
okr: OKR-2026-Q1-01
priority: medium
labels: [testing, docs]
story_points: 2
created_at: "2026-02-18T01:52:42-03:00"
created_by: "codex"
assigned_to: codex
review_requested_from: [codex]
depends_on: [TASK-0179, TASK-0180, TASK-0181]
blocks: []
acted_by:
  - agent: "codex"
    action: created
    date: "2026-02-18T01:52:42-03:00"
  - agent: "codex"
    action: claimed
    date: "2026-02-18T04:09:55-03:00"
  - agent: "codex"
    action: completed
    date: "2026-02-18T04:11:04-03:00"
  - agent: "codex"
    action: review_approved
    date: "2026-02-18T04:12:35-03:00"
tokens_used: 1212509
tokens_by_phase:
  backlog: 49580
---

## Descricao

Executar validacao ponta a ponta do onboarding por QR ate comunicacao MQTT operacional, documentando runbook de suporte para incidentes comuns.

## Criterios de Aceite

- [x] Cenário E2E principal validado com evidencias
- [x] Cenários de falha (token invalido, nao aprovado, ACL negada) validados
- [x] Runbook objetivo publicado para operacao e suporte

## Contexto Tecnico

Cobrir backend, firmware e broker no fluxo completo, com comandos e checkpoints reproduziveis.

## Notas de Progresso

### [2026-02-18 01:52] codex
Tarefa criada para consolidar qualidade e operabilidade do fluxo.

### [2026-02-18 04:11] codex
Validacao e documentacao concluidas.
Evidencias de teste:
- `docker compose exec -T ... pytest tests/test_device_association.py::{test_factory_provision,test_claim_device,test_approve_association,test_acl_server_accesses_client_topic,test_claim_device_reused_setup_token,test_acl_server_denied_other_topic} -v`
- `docker compose exec -T ... pytest tests/test_mqtt_auth.py::{test_mqtt_acl_unapproved_server_only_onboarding_topic,test_mqtt_acl_device_other_topic} -v`
- Resultado consolidado: `8 passed`.
Runbook publicado:
- `docs/dev/RUNBOOK_QR_ONBOARDING_MQTT.md`

### [2026-02-18 04:12] codex
QA aprovado.
