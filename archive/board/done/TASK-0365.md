---
id: TASK-0365
title: "Frontend: fluxo do teste (instrucoes + timer + captura foto + titulacao)"
project: aquario
sprint: sprint-048
okr: null
priority: medium
labels: [feature, ux]
story_points: 5
created_at: "2026-02-21T06:30:00-03:00"
created_by: "claude-code"
assigned_to: claude-code
review_requested_from: [codex]
depends_on: [TASK-0364]
blocks: [TASK-0366]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-21T06:30:00-03:00"
  - agent: "claude-code"
    action: moved_to_review
    date: "2026-02-21T14:00:00-03:00"
  - agent: "codex"
    action: qa_approved
    date: "2026-02-21T16:49:34-03:00"
tokens_used: 28861
tokens_by_phase:
  backlog: 2829
  todo: 26034
---

## Descricao

Implementar a pagina do fluxo de teste quimico no frontend. Apos o usuario selecionar um kit na pagina `/readings/test-kit`, ele e redirecionado para `/readings/test-kit/{id}` onde ve instrucoes de uso, timer countdown opcional baseado no wait_seconds do kit, area de captura de foto (camera mobile ou upload desktop) e, para testes de titulacao, campo numerico para contagem de gotas.

## Criterios de Aceite

- [x] Pagina `/readings/test-kit/[id]` com instrucoes do kit selecionado
- [x] Componente `TestTimer` com countdown baseado em wait_seconds (iniciar/pausar/pular)
- [x] Componente `PhotoCapture` com opcao de camera (mobile) e upload de arquivo (desktop)
- [x] Preview da foto capturada antes de enviar
- [x] Para testes colorimetricos: envio da foto ao endpoint analyze
- [x] Para testes de titulacao: campo numerico "Quantas gotas ate a mudanca de cor?" com calculo automatico (gotas x conversion_factor)
- [x] Loading state durante analise
- [x] Todos os textos em pt-BR
- [x] Responsivo (mobile-first para captura de foto)

## Contexto Tecnico

- Spec: `docs/dev/TEST_KITS.md` secoes 4.1 (passo 2), 4.3 (timer), 7.2 e 7.3
- Wireframe: secao 4.1 "Passo 2 - Instrucoes + Captura"
- Componentes novos: `TestTimer`, `PhotoCapture`
- API: usa `POST /api/v1/test-kits/{id}/analyze` do TASK-0364
- Pagina existente a estender: `frontend/src/app/(authenticated)/readings/test-kit/page.tsx`
- Criar pagina: `frontend/src/app/(authenticated)/readings/test-kit/[id]/page.tsx`
- Store: `frontend/src/stores/test-kit-store.ts` (adicionar acoes de analise)

## Notas de Progresso

- Pagina `/readings/test-kit/[id]` com fluxo step-by-step: instrucoes -> timer -> captura -> analise -> resultado
- TestTimer: countdown circular SVG com play/pause/skip
- PhotoCapture: camera mobile (capture=environment) + upload desktop, preview antes de enviar
- TitrationInput: contador de gotas +/- com calculo automatico (gotas x conversion_factor)
- Loading state com spinner durante analise
- Resultado: cor detectada, confianca, valor sugerido, closest values, ajuste manual
- Confirmacao: salva leitura via endpoint confirm
- Todos os textos em pt-BR, layout responsivo mobile-first (max-w-2xl)
- Adicionadas funcoes analyzeTestKit() e confirmAnalysis() na API client
- Botao "Analisar com Foto" / "Registrar Titulacao" na pagina de selecao
- Build OK. Commit: e19df64

### [2026-02-21 16:49] codex
QA aprovado.
- Fluxo da pagina de teste validado com instrucoes, timer, captura, preview e titulacao.
- Integracao com analyze e confirm no frontend confirmada.
- Cobertura dos criterios de UX em pt-BR e layout responsivo observada no componente principal.
