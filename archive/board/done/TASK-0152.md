---
id: TASK-0152
title: "Frontend: adicionar prévia rica de espécie no cadastro de habitante"
project: aquario
sprint: sprint-018
okr: OKR-2026-Q1-01
priority: high
labels: [feature, frontend, ux]
story_points: 3
created_at: "2026-02-16T18:42:11-03:00"
created_by: codex
assigned_to: codex
review_requested_from: []
depends_on: []
blocks: []
acted_by:
  - agent: codex
    action: created
    date: "2026-02-16T18:42:11-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-16T18:45:13-03:00"
  - agent: codex
    action: complete
    date: "2026-02-16T18:47:18-03:00"
  - agent: codex
    action: update
    date: "2026-02-16T19:03:42-03:00"
  - agent: codex
    action: complete
    date: "2026-02-16T19:04:07-03:00"
  - agent: codex
    action: update
    date: "2026-02-16T19:07:00-03:00"
  - agent: codex
    action: complete
    date: "2026-02-16T19:07:12-03:00"
  - agent: codex
    action: update
    date: "2026-02-16T19:09:57-03:00"
  - agent: codex
    action: complete
    date: "2026-02-16T19:10:11-03:00"
  - agent: codex
    action: update
    date: "2026-02-16T19:12:07-03:00"
  - agent: codex
    action: complete
    date: "2026-02-16T19:13:01-03:00"
  - agent: codex
    action: update
    date: "2026-02-16T19:18:41-03:00"
  - agent: codex
    action: complete
    date: "2026-02-16T19:20:47-03:00"
  - agent: codex
    action: update
    date: "2026-02-16T19:25:05-03:00"
  - agent: codex
    action: complete
    date: "2026-02-16T19:25:40-03:00"
  - agent: codex
    action: update
    date: "2026-02-16T19:39:08-03:00"
  - agent: codex
    action: complete
    date: "2026-02-17T00:04:43-03:00"
tokens_used: 2910878
tokens_by_phase:
  backlog: 973125
  review: 777426
---

## Descricao

Adicionar uma prévia detalhada da espécie no formulário "Adicionar Habitante", incluindo características principais, origem, nome científico, tipos de aquário compatíveis e imagem da espécie.

## Criterios de Aceite

- [x] Ao selecionar uma espécie, a UI exibe prévia com nome comum, nome científico, origem e tipo(s) de aquário compatíveis.
- [x] A UI exibe informações adicionais relevantes (porte, comportamento, parâmetros e cuidados quando disponíveis).
- [x] A UI exibe foto da espécie com fallback visual quando não houver imagem.
- [x] Testes de frontend cobrindo renderização da prévia passam localmente.

## Contexto Tecnico

Implementação principal em `frontend/src/components/livestock/livestock-add-dialog.tsx` com reaproveitamento do `selectedSpecies` retornado pelo componente de busca.

## Notas de Progresso

### [2026-02-16 18:42] codex
Tarefa criada para registrar a evolução da melhoria de preview de espécies solicitada pelo proprietário.

### [2026-02-16 18:47] codex
Prévia da espécie foi enriquecida com resumo completo (origem, científico, parâmetros, comportamento, longevidade, compatibilidade de aquário e características complementares), incluindo imagem com fallback e cobertura de testes em `livestock-add-dialog.test.tsx`.

### [2026-02-16 19:04] codex
Ajuste corretivo na exibição de fotos: substituído fallback de URLs estáticas por resolução dinâmica de thumbnail da Wikipedia via nome científico (quando `image_url` vier nulo), com fallback textual em erro de carregamento.

### [2026-02-16 19:07] codex
Adicionado lightbox na prévia da espécie: clique na miniatura abre imagem ampliada com overlay, fechamento por botão, clique fora e tecla ESC; cobertura de teste adicionada.

### [2026-02-16 19:10] codex
Corrigido fluxo de busca por espécie: quando a categoria selecionada não contém o nome pesquisado, o componente tenta automaticamente em todas as categorias e exibe aviso contextual para evitar falso "Nenhuma espécie encontrada".

### [2026-02-16 19:13] codex
Ao trocar categoria, o campo de busca por nome agora é limpo automaticamente e os resultados/hints anteriores são descartados para evitar seleção inconsistente com filtro antigo.

### [2026-02-16 19:20] codex
Ajustado UX do modal em telas grandes: largura responsiva ampliada (`md`/`lg`/`xl`) para visual mais quadrado no desktop de alta resolução, preservando proporção e rolagem no mobile.

### [2026-02-16 19:25] codex
Layout do bloco de detalhes da espécie atualizado para 3 colunas em desktop grande (`xl`), mantendo 1 coluna no mobile e 2 no tablet/desktop médio para legibilidade.

### [2026-02-16 19:39] codex
Continuidade da tarefa para hardening de testes: removidos warnings de `act(...)` em `species-search.test.tsx` sincronizando os testes iniciais com o carregamento assíncrono de categorias; suíte relacionada validada (`livestock-add-dialog` + `species-search`, 39 testes passando).

### [2026-02-17 00:04] codex
QA concluido: criterios e evidencias validados; card aprovado para done.
