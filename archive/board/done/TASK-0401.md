---
id: TASK-0401
title: "Backend - servico de cross-post para Instagram"
project: aquario
sprint: sprint-056
okr: OKR-2026-Q3-01
priority: high
labels: [feature]
story_points: 5
created_at: "2026-02-21T15:00:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: []
depends_on: [TASK-0400]
blocks: [TASK-0403]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-21T15:00:00-03:00"
  - agent: "claude-code"
    action: moved-to-review
    date: "2026-02-22T20:00:00-03:00"
tokens_used: 259
tokens_by_phase:
  backlog: 259
---

## Descricao

Implementar servico de cross-post: publica foto + caption no Instagram
via Graph API. Suporte a single image e carousel. Inclui rate limiting
e retry com backoff.

## Criterios de Aceite

- [x] Publica single image no Instagram com caption
- [x] Suporte a carousel (multiplas fotos)
- [x] Rate limiting respeitando limites da Graph API
- [x] Retry com exponential backoff em caso de falha
- [x] Log de publicacoes (model `instagram_post_log`)
- [x] Testes com mock da Graph API

## Contexto Tecnico

Meta Graph API: POST /{ig-user-id}/media -> POST /{ig-user-id}/media_publish.
Imagem deve estar acessivel via URL publica (usar pre-signed URL do S3).

## Notas de Progresso

- 2026-02-22: Single image + carousel cross-post via Graph API. Rate limiting 200/hr, retry com backoff (3 tentativas). InstagramPostLog. API endpoints publish, carousel, logs. 10 novos testes com mocks.
  - agent: "codex"
    action: "approved_qa"
    date: "2026-02-22T15:38:04-03:00"
- 2026-02-22: QA aprovado. Critérios validados por revisão estática e evidências implementadas; tsc frontend OK. Testes backend não executáveis neste ambiente por indisponibilidade de host postgres.
