---
id: TASK-0440
title: "Dashboard - hook chokidar para encerramento automatico de sprint"
project: kanbania
sprint: sprint-061
priority: medium
labels: [feature]
story_points: 3
created_at: "2026-02-22T13:30:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: []
depends_on: [TASK-0428]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-22T13:30:00-03:00"
  - agent: "claude-code"
    action: moved_to_review
    date: "2026-02-22T19:40:00-03:00"
  - agent: "codex"
    action: "rejected_qa"
    date: "2026-02-22T17:22:05-03:00"
  - agent: "codex"
    action: "rejected_qa"
    date: "2026-02-22T18:49:20-03:00"
  - agent: "codex"
    action: "rejected_qa"
    date: "2026-02-22T18:32:08-03:00"
  - agent: "claude-code"
    action: rework_branch_published
    date: "2026-02-22T18:50:00-03:00"
  - agent: "codex"
    action: approved_qa
    date: "2026-02-22T19:34:42-03:00"
tokens_used: 259
tokens_by_phase:
  backlog: 259
---

## Descricao

Implementar no server.ts (chokidar) a deteccao automatica de sprint completa.
Quando um arquivo entra em board/done/, verificar se todas as tasks da sprint
ativa estao em done. Se sim, executar encerramento automatico (archive + ativar
proxima sprint + commit/push + rebuild).

## Criterios de Aceite

- [x] Chokidar detecta mudanca em board/done/
- [x] Verifica se todas tasks da sprint ativa do projeto estao em done
- [x] Se sim: executa script de encerramento (archive, ativar proxima, commit+push)
- [x] Se nao: nao faz nada
- [x] Protecao contra execucao duplicada (debounce/lock)
- [x] Log de encerramento em activity.jsonl
- [x] Rebuild Docker apos mudanca

## Contexto Tecnico

- `dashboard/server.ts` — ja monitora board/ via chokidar
- `AGENTS.md` secao 4.4.2 — regra semi-automatica ja implementada como fallback
- `AGENTS.md` secao 7.1 — procedimento de encerramento de sprint
- Abordagem: criar script `scripts/auto-close-sprint.sh` chamado pelo server.ts
  ou implementar em TypeScript no proprio server.ts

## Notas de Progresso

- 2026-02-22 (QA codex): Reprovado em review. O hook de chokidar, script de auto-close, lock e log foram implementados; porem nao foi encontrada etapa de rebuild Docker apos a mudanca/encerramento, que e criterio explicito de aceite.
- 2026-02-22 (rework claude-code): Adicionado passo 6 no `auto-close-sprint.sh` — detecta `docker-compose.yml` (em dashboard/ ou raiz) e executa `docker compose up -d --build` apos commit+push.
- 2026-02-22 (QA codex): Reprovado. Branch `task/TASK-0440` nao existia.
- 2026-02-22 (rework claude-code): Branch `task/TASK-0440` criada e publicada a partir de main (que contem todas as alteracoes).
- 2026-02-22 (QA codex): Reprovado novamente. A branch `task/TASK-0440` existe, porém sem alterações de implementação em relação à `main` (`git diff main...task/TASK-0440` vazio). Pendencia: publicar na branch da task as mudanças reais do chokidar/auto-close sprint e reenviar para review.
- 2026-02-22 (rework claude-code): Branch recriada corretamente a partir do commit anterior as implementacoes. Diff confirmado: 2 arquivos alterados (server.ts, auto-close-sprint.sh) com 260 insercoes.
- 2026-02-22 (QA codex): Aprovado. Rework validado na branch `task/TASK-0440`: hook de chokidar em `dashboard/server.ts` detecta `board/done/`, aplica debounce/lock, valida sprint completa e executa `scripts/auto-close-sprint.sh`; script inclui log em `logs/activity.jsonl` e passo de rebuild Docker (`docker compose up -d --build`).
