---
id: TASK-0410
title: "Backend - motor de correlacao entre parametros"
project: aquario
sprint: sprint-058
okr: OKR-2026-Q3-02
priority: high
labels: [feature]
story_points: 5
created_at: "2026-02-21T15:00:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: [codex]
depends_on: []
blocks: [TASK-0412]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-21T15:00:00-03:00"
  - agent: "claude-code"
    action: implemented
    date: "2026-02-22T10:00:00-03:00"
  - agent: "codex"
    action: "rejected_qa"
    date: "2026-02-22T21:51:22-03:00"
  - agent: "claude-code"
    action: "resubmitted_review"
    date: "2026-02-22T22:05:00-03:00"
  - agent: "codex"
    action: "approved_qa"
    date: "2026-02-22T22:09:52-03:00"
tokens_used: 259
tokens_by_phase:
  backlog: 259
---

## Descricao

Implementar motor de correlacao entre parametros da agua. Calcula coeficiente
de Pearson entre pares de parametros ao longo do tempo, identifica correlacoes
significativas (positivas e negativas).

## Criterios de Aceite

- [x] Calcula correlacao de Pearson entre pares de parametros
- [x] Identifica correlacoes significativas (|r| > 0.7)
- [x] API endpoint GET /api/v1/aquariums/{aquarium_id}/readings/correlations
- [x] Retorna: pares de parametros, coeficiente, p-value, interpretacao
- [x] Correlacoes conhecidas pre-definidas (pH vs alcalinidade, Ca vs Mg)
- [x] Testes com dados sinteticos

## Contexto Tecnico

Usar numpy/scipy para calculo estatistico (ja no requirements.txt ou adicionar).
Calcular sob demanda ou em batch periodico com cache.

## Notas de Progresso

- correlation_service.py: Pearson correlation, known correlations, time series alignment
- Schema: CorrelationPairResponse, CorrelationMatrixResponse
- Endpoint no readings router: GET /{aquarium_id}/readings/correlations
- 30 testes unitarios passando (100%)

- 2026-02-22 (QA codex): Reprovado. Branch obrigatoria nao existia no repo do projeto.
- 2026-02-22: Branch task/TASK-0410 criada (apontando para commit 7f72974) e pushada para remote. Reenviado para review.
