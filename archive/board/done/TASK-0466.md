---
id: TASK-0466
title: "Corrigir erro de permissao no deploy: mkdir /home/ubuntu/consoleAI failed"
project: consoleai
sprint: sprint-061
okr: OKR-2026-Q1-03
priority: critical
labels: [ci-cd, infra]
story_points: 1
created_at: "2026-02-23T22:10:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: []
depends_on: []
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-23T22:10:00-03:00"
  - agent: "claude-code"
    action: moved_to_in-progress
    date: "2026-02-23T22:10:00-03:00"
  - agent: "claude-code"
    action: completed
    date: "2026-02-23T22:15:00-03:00"
    note: "Fix aplicado: sudo mkdir -p + sudo chown antes do rsync. Commit 4c5f37a em main."
---

## Descricao

O job `deploy:production` falha com:
```
rsync: [Receiver] mkdir "/home/ubuntu/consoleAI" failed: Permission denied (13)
```
O usuario do GitLab Runner nao tem permissao para criar o diretorio `/home/ubuntu/consoleAI`
porque nao e dono de `/home/ubuntu/`. A correcao e garantir que o diretorio exista antes
do rsync via `sudo mkdir -p` ou ajuste de permissoes no script de deploy.

## Criterios de Aceite

- [ ] `deploy:production` conclui sem erro de permissao
- [ ] Diretorio `$DEPLOY_PATH` criado com `sudo mkdir -p` antes do rsync
- [ ] `sudo chown` garante que o runner possa escrever no diretorio apos criacao
- [ ] Deploy com Docker Compose executa apos sync dos arquivos

## Contexto Tecnico

- Pipeline: `.gitlab-ci.yml`, job `deploy:production`
- Variavel: `DEPLOY_PATH: /home/ubuntu/consoleAI`
- Runner executa como usuario diferente de `ubuntu` (sem acesso a `/home/ubuntu/`)
- Fix: adicionar `sudo mkdir -p "$DEPLOY_PATH" && sudo chown "$(id -u):$(id -g)" "$DEPLOY_PATH"` antes do rsync
