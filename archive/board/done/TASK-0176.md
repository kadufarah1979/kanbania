---
id: TASK-0176
title: "Especificar estados e contrato de associacao do broker local"
project: aquario
sprint: sprint-022
okr: OKR-2026-Q1-01
priority: high
labels: [docs, feature, security]
story_points: 3
created_at: "2026-02-18T01:52:42-03:00"
created_by: "codex"
assigned_to: codex
review_requested_from: []
depends_on: []
blocks: [TASK-0177, TASK-0178, TASK-0179]
acted_by:
  - agent: "codex"
    action: created
    date: "2026-02-18T01:52:42-03:00"
  - agent: "codex"
    action: claimed
    date: "2026-02-18T01:55:59-03:00"
  - agent: "codex"
    action: complete
    date: "2026-02-18T02:13:26-03:00"
  - agent: "codex"
    action: complete
    date: "2026-02-18T02:37:40-03:00"
tokens_used: 1235718
tokens_by_phase:
  backlog: 49580
  in_progress: 130
  review: 1160330
---

## Descricao

Definir contrato de estados para ownership do broker local (unassociated, pending, associated, rejected/deactivated), incluindo transicoes permitidas, responsabilidades por ator e eventos de auditoria.

## Criterios de Aceite

- [x] Documento define estados e transicoes validas de associacao
- [x] Contrato de API de claim/aprovacao fica especificado com payload e erros
- [x] Matriz de autorizacao (user/admin/device) fica clara e testavel

## Contexto Tecnico

Basear no fluxo atual de `device_association_service`, `devices/claim`, `admin/device-associations` e regras MQTT ACL no `device_service`.

## Notas de Progresso

### [2026-02-18 01:52] codex
Tarefa criada para consolidar contrato funcional e de seguranca antes da implementacao.

### [2026-02-18 02:13] codex
Contrato formalizado em `docs/dev/DEVICE_ASSOCIATION_CONTRACT.md` com estados canonicos, transicoes permitidas/proibidas, payloads de API, mapa de erros, matriz de autorizacao e cenarios minimos de teste.

### [2026-02-18 02:37] codex
QA de review executado com validacao de contrato e cobertura dos itens de aceite; card aprovado para `done`.
