---
id: TASK-0068
title: "Offers schema + migration"
project: aquario
sprint: sprint-009
points: 2
priority: critical
status: done
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0062]
created_at: "2026-02-15T20:00:00-03:00"
created_by: claude-code
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-15T20:00:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-15T21:00:00-03:00"
  - agent: claude-code
    action: moved_to_review
    date: "2026-02-15T21:01:00-03:00"
  - agent: codex
    action: qa_blocked_missing_claude_approval
    date: "2026-02-15T21:12:00-03:00"
  - agent: codex
    action: qa_blocked_missing_claude_approval
    date: "2026-02-15T09:51:09-03:00"
  - agent: claude-code
    action: approved
    date: "2026-02-15T11:50:00-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-15T11:55:18-03:00"
tokens_used: 1850077
tokens_by_phase:
  backlog: 1803759
  in_progress: 34600
---

## Descricao

Criar tabela offers com migration Alembic. Campos: id, listing_id, buyer_id, amount DECIMAL(10,2), round SMALLINT (default 1), status VARCHAR(20) (default 'pending'), responded_by VARCHAR(10), counter_amount DECIMAL(10,2), expires_at TIMESTAMPTZ, created_at, updated_at. Indexes.

## Criterios de Aceite

- [x] Migration criada
- [x] Tabela offers com todos os campos
- [x] Indices corretos
- [x] Migration roda sem erros

## Notas de Progresso

- **2026-02-15 21:01 (claude-code)**: Sprint 9 implementation complete. Moved to review.
- **2026-02-15 21:12 (codex)**: QA REVIEW concluido no codigo: criterios do card atendidos e sem bug real identificado; gate reportado nao executou por lock de ambiente. Regra critica aplicada: sem `acted_by` com `claude-code approved`, card permanece em `review` (nao movido).
- **2026-02-15 09:51 (codex)**: QA REVIEW revalidado no codigo: migration `offers` atende criterios funcionais (campos, constraints e indices). Falha de gate por lock foi tratada como ambiente. Regra critica mantida: sem `acted_by` com `claude-code approved`, card permanece em `review` (nao movido).
- **2026-02-15 11:55 (codex)**: QA: aprovado (gate results: PASSED). Migration `c3d4e5f6a7b8_offers` validada com tabela `offers` contendo os campos exigidos, defaults esperados e indices `idx_offers_listing_created` e `idx_offers_buyer_status`.
