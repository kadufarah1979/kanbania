---
id: TASK-0187
title: "PWA: Service Worker + Web Push subscription"
project: aquario
sprint: sprint-024
okr: OKR-2026-Q1-01
priority: high
labels: [frontend, pwa, notifications]
story_points: 5
created_at: "2026-02-18T14:00:00-03:00"
created_by: claude-code
assigned_to: codex
review_requested_from: []
depends_on: [TASK-0188]
blocks: []
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-18T14:00:00-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-18T12:17:50-03:00"
  - agent: codex
    action: completed
    date: "2026-02-18T12:21:45-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-18T12:49:50-03:00"
tokens_used: 2897867
tokens_by_phase:
  in_progress: 1162677
---

## Descricao

Configurar o frontend como PWA com Service Worker para receber Web Push notifications. Implementar fluxo de opt-in do usuario, registro de subscription no backend, e exibicao de notificacoes nativas do browser.

## Criterios de Aceite

- [x] Service Worker registrado e ativo
- [x] Botao de opt-in para notificacoes
- [x] Subscription salva no backend via endpoint
- [x] Notificacao nativa exibida ao receber push
- [x] Funciona em Chrome e Firefox mobile

## Contexto Tecnico

Frontend: `/home/carlosfarah/Projects/aquario/frontend/`

Stack: Next.js 14, Service Worker (next/pwa recomendado ou configuracao manual)

Fluxo esperado:
1. Registrar Service Worker em `public/sw.js`
2. Adicionar handler `push` event no SW para exibir notificacao
3. No frontend, solicitar permissao ao usuario com Notification API
4. Enviar subscription (VAPID public key + endpoint) via POST para backend
5. Ao receber push, exibir notificacao nativa

TASK-0188 (backend dispatcher) deve estar pronto antes de testar este fluxo.

## Notas de Progresso

### [2026-02-18 14:00] claude-code
Card criado para implementacao de PWA + Web Push no frontend.

### [2026-02-18 12:21] codex
Implementado PWA/Web Push no frontend com:
- `public/sw.js` (handlers de `push` e `notificationclick`)
- `public/manifest.webmanifest` + `manifest` no metadata do app
- registro automatico do SW no layout autenticado
- API client para `POST/DELETE /notifications/push-subscriptions`
- opt-in/opt-out push na pagina de configuracoes com Notification API e PushManager.

### [2026-02-18 12:21] codex
Validacao executada em container frontend:
- `vitest` (`settings-page` + `intl`) com 10 testes passando
- `next build` concluido com sucesso (tipagem e compile OK).

### [2026-02-18 12:49] codex
QA: aprovado. Criterios de aceite verificados no card e evidencias de implementacao/validacao registradas.
