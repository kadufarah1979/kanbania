---
id: TASK-0399
title: "Backend - testes de integracao do fluxo de marcos"
project: aquario
sprint: sprint-055
okr: OKR-2026-Q3-01
priority: medium
labels: [testing]
story_points: 3
created_at: "2026-02-21T15:00:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: [codex]
depends_on: [TASK-0395, TASK-0396]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-21T15:00:00-03:00"
  - agent: "claude-code"
    action: moved-to-review
    date: "2026-02-22T18:00:00-03:00"
tokens_used: 259
tokens_by_phase:
  backlog: 259
---

## Descricao

Testes de integracao do fluxo completo: evento trigger -> deteccao de marco ->
geracao de post -> notificacao. Cobrir cenarios de marcos unicos e recorrentes.

## Criterios de Aceite

- [x] Teste: adicionar livestock -> detecta marco "primeiro coral" -> gera post
- [x] Teste: N dias desde criacao -> detecta marco "100 dias" -> gera post
- [x] Teste: marco ja atingido nao dispara novamente (idempotencia)
- [x] Teste: marco desativado pelo usuario nao gera post

## Contexto Tecnico

Testes em `tests/test_milestones.py`. Usar fixtures de aquario e livestock.

## Notas de Progresso

- 2026-02-22: 5 testes de integracao em tests/test_milestones_integration.py. Cobre: fluxo completo coral->post, 100 dias nao dispara em aquario jovem, idempotencia, marcos desabilitados, fluxo E2E via API. Todos passando.
