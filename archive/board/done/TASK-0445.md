---
id: TASK-0445
title: "Criar tabelas PostgreSQL para FinOps (finops_sync, finops_decisions, cost_cache)"
project: consoleai
sprint: sprint-061
okr: OKR-2026-Q1-03
priority: critical
labels: [database, infra]
story_points: 2
created_at: "2026-02-23T10:40:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: []
blocks: [TASK-0446, TASK-0447]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-23T10:40:00-03:00"
  - agent: "claude-code"
    action: completed
    date: "2026-02-23T15:00:00-03:00"
    note: "cost_cache DDL + get_cached_cost/set_cached_cost/invalidate_cost_cache + 10 tests"
---

## Descricao

Criar migration/schema PostgreSQL para as tabelas FinOps que hoje existem no SQLite: `finops_sync_runs`, `finops_decisions` e adicionar nova tabela `cost_cache` para armazenar custo por tenant com TTL. Integrar com o init_db existente em `auth/database.py`.

## Criterios de Aceite

- [ ] Migration SQL cria tabelas `finops_sync_runs`, `finops_decisions`, `cost_cache` no PostgreSQL
- [ ] Schema de `cost_cache` inclui: tenant_id, period, cost_usd, cached_at, expires_at
- [ ] `init_db()` em `auth/database.py` executa as novas migrations automaticamente
- [ ] Script de verificacao confirma tabelas criadas corretamente

## Contexto Tecnico

- Seguir padrao de `auth/database.py` para criacao de tabelas
- `cost_cache.expires_at` = cached_at + 1 hora (TTL padrao)
- Tipos: tenant_id TEXT, period TEXT (YYYY-MM), cost_usd REAL, cached_at TEXT, expires_at TEXT

## Notas de Progresso

