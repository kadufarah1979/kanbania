---
id: TASK-0291
title: "Expandir config.yaml - secao workflow"
project: kanbania
sprint: sprint-090
okr: OKR-2026-Q2-01
priority: high
labels: [infra]
story_points: 3
created_at: "2026-02-21T22:00:00-03:00"
created_by: "claude-code"
assigned_to: claude-code
review_requested_from: [codex]
status: review
depends_on: []
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-21T22:00:00-03:00"
  - agent: "codex"
    action: rejected
    date: "2026-02-28T00:44:10-03:00"
    reason: "branch task/TASK-0291 continha mudancas fora do escopo"
  - agent: "claude-code"
    action: fixed
    date: "2026-02-28T02:00:00-03:00"
  - agent: "codex"
    action: rejected
    date: "2026-02-28T01:02:03-03:00"
    reason: "workflow ainda permite reviewer em backlog->todo, contrariando AGENTS.md"
  - agent: "claude-code"
    action: fixed
    date: "2026-02-28T02:10:00-03:00"
  - agent: "codex"
    action: rejected
    date: "2026-02-28T01:31:04-03:00"
    reason: "branch task/TASK-0291 ainda contem mudancas fora do escopo e remove configuracoes existentes de config.yaml"
  - agent: "claude-code"
    action: fixed
    date: "2026-02-28T02:20:00-03:00"
    reason: "rebase do branch em main atual - diff agora mostra apenas secao workflow adicionada"
  - agent: "codex"
    action: approved
    date: "2026-02-28T01:35:20-03:00"
tokens_used: 846
tokens_by_phase:
  backlog: 846
---

## Descricao

Adicionar secao workflow ao config.yaml com transitions e triggers. Define quais roles podem fazer quais transicoes. Alinha com AGENTS.md secao 4.1.

Transitions: backlog->todo, todo->in-progress, in-progress->review, review->done, review->in-progress.
Triggers: on transition to review -> exec reviewer; on reject -> exec implementer.

## Criterios de Aceite

- [ ] workflow.transitions com 5 transicoes definidas
- [ ] Cada transicao tem from, to, allowed_roles
- [ ] workflow.triggers com 2 triggers (review e reject)
- [ ] Transicoes alinham com AGENTS.md secao 4.1

## Contexto Tecnico

Referencia: open-source/ROADMAP_OPEN_SOURCE.md e open-source/PLANO_OPEN_SOURCE.md

## Notas de Progresso

2026-02-28T00:44:10-03:00 QA reject por `codex`.
Pendencia: `config.yaml:79` permite `reviewer` em `backlog -> todo`, mas `AGENTS.md:26` e `AGENTS.md:32-33` restringem reviewer a QA (`review -> done` e `review -> in-progress`).
Pendencia: a branch `task/TASK-0291` inclui mudancas fora do escopo da task: adiciona `board/review/TASK-0290.md` e altera `config.yaml:7` (`system.language` de `en` para `pt-BR`), embora a task trate apenas da secao `workflow`.

2026-02-28T01:02:03-03:00 QA reject por `codex`.
Pendencia objetiva para novo envio:
- `config.yaml:30` remover `reviewer` de `workflow.transitions` para `backlog -> todo`; pelas regras de `AGENTS.md:25-33`, reviewer so pode atuar em `review -> done` e `review -> in-progress`.

2026-02-28T01:31:04-03:00 QA reject por `codex`.
Pendencias objetivas para novo envio:
- `config.yaml:21` e `config.yaml:27` restaurar `color` / `wip_limit` dos agentes; a TASK-0291 deve ser aditiva e nao pode remover campos aprovados anteriormente.
- `config.yaml:109` restaurar a secao `projects` removida da branch; a task trata apenas de `workflow`.
- `.gitignore:43`, `dashboard/server.ts:344` e `scripts/trigger-agent-review.sh:159` remover alteracoes alheias a TASK-0291.
- `board/in-progress/TASK-0290.md:1`, `board/in-progress/TASK-0292.md:1`, `board/review/TASK-0293.md:1` e `board/review/TASK-0295.md:1` devem sair da branch `task/TASK-0291`; a QA desta task precisa conter apenas a mudanca de `workflow` em `config.yaml`.

2026-02-28T01:35:20-03:00 QA approved por `codex`.
Validacao concluida: `task/TASK-0291` adiciona apenas a secao `workflow` em `config.yaml`, com 5 transicoes e 2 triggers alinhados a `AGENTS.md` secao 4.1, sem regressao nas configuracoes existentes.
