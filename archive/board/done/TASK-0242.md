---
id: TASK-0242
title: "Frontend: dashboard de status dos relay channels com historico de acoes"
project: aquario
sprint: sprint-030
okr: OKR-2026-Q1-02
priority: medium
labels: [feature, frontend, ux]
story_points: 3
created_at: "2026-02-19T16:30:00-03:00"
created_by: claude-code
assigned_to: codex
review_requested_from: []
depends_on: [TASK-0238]
blocks: []
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-19T16:30:00-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-19T03:27:05-03:00"
  - agent: codex
    action: move-to-review
    date: "2026-02-19T03:30:21-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-19T14:00:47-03:00"

tokens_used: 1579796
tokens_by_phase:
  in_progress: 1560667
---

## Descricao

Adicionar ao dashboard principal (ou pagina de automacao) uma secao de status dos relay channels mostrando estado atual de cada canal, ultimo acionamento, e historico recente de acoes (RelayActionLog).

## Criterios de Aceite

- [x] Card de status por relay channel com: nome, estado on/off, last_toggled_at
- [x] Timeline de acoes recentes (ultimas 10) com triggered_by (manual/rule/schedule) e timestamp
- [x] Atualizacao em tempo real via WebSocket quando estado muda
- [x] Responsivo (mobile-first)
- [x] Testes para o componente

## Notas de Progresso

### [2026-02-19T03:30:21-03:00] codex
Implementacao concluida para dashboard de relay channels com historico de acoes:
- UI: novo componente `RelayChannelDashboard` na tab "Controle Manual", com card por canal (nome, estado, last_toggled_at) e timeline por canal.
- Dados: store `relay-store` com `fetchChannelHistory` (page_size=10) e API `GET /api/v1/relays/{channel_id}/history`.
- Tempo real: correcao no handler WebSocket para mapear atualizacao por `device_id + channel_number` (evita atualizar canal errado).
- Testes adicionados/atualizados:
  - `frontend/src/__tests__/components/relay-channel-dashboard.test.tsx`
  - `frontend/src/__tests__/pages/automation-page.test.tsx` (inclui caso por `device_id`)
  - `backend/tests/test_automation_service.py` (endpoint de historico por canal)
- Evidencias:
  - `npm test -- src/__tests__/components/relay-channel-dashboard.test.tsx src/__tests__/pages/automation-page.test.tsx src/__tests__/stores/relay-store.test.ts` => 18 passed.
  - `docker compose exec -T backend pytest -q tests/test_automation_service.py -k "relay_channel_history_endpoint or list_relays_endpoint or toggle_relay_endpoint"` => 3 passed.

- 2026-02-19T14:00:47-03:00 codex: QA concluido; criterios de aceite validados, aprovado para done.
