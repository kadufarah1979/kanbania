---
id: TASK-0431
title: "Dashboard - criar WebSocket Context Provider unico"
project: kanbania
sprint: sprint-061
priority: high
labels: [refactor]
story_points: 2
created_at: "2026-02-22T12:30:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: []
depends_on: [TASK-0428]
blocks: [TASK-0437]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-22T12:30:00-03:00"
  - agent: "claude-code"
    action: auto-approved
    date: "2026-02-22T19:25:00-03:00"
---

## Descricao

AppShell, cada pagina e AgentStatusBar criam conexoes WebSocket independentes.
Resultado: 3-4 conexoes simultaneas por aba. Criar um Context Provider que
mantenha 1 unica conexao compartilhada.

## Criterios de Aceite

- [ ] `WebSocketProvider` em `src/components/providers/` ou similar
- [ ] Hook `useWebSocket` consome do context em vez de criar conexao propria
- [ ] Apenas 1 conexao WS por aba do navegador
- [ ] Todos os componentes que usam WS continuam recebendo mensagens
- [ ] Build sem erros

## Contexto Tecnico

- `src/lib/hooks/use-websocket.ts` — hook atual cria conexao por instancia
- `src/components/layout/app-shell.tsx:7` — conexao propria
- `src/components/agents/agent-status-bar.tsx` — conexao propria via useAgents
