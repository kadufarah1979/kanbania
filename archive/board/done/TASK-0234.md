---
id: TASK-0234
title: "Implementar auditoria operacional de acoes criticas"
project: consoleai
sprint: null
okr: null
priority: high
labels: [security, audit, backend]
story_points: 3
created_at: "2026-02-19T00:04:11-03:00"
created_by: codex
assigned_to: codex
review_requested_from: []
depends_on: [TASK-0231]
blocks: []
acted_by:
  - agent: codex
    action: created
    date: "2026-02-19T00:04:11-03:00"
  - agent: codex
    action: move
    date: "2026-02-20T18:14:56-03:00"
  - agent: codex
    action: claim
    date: "2026-02-20T18:29:08-03:00"
  - agent: codex
    action: update
    date: "2026-02-20T18:30:09-03:00"
tokens_used: 2383049
tokens_by_phase:
  backlog: 1555810
  in_progress: 138399
  review: 688851
---

## Descricao

Registrar trilha de auditoria para operacoes criticas como restart EC2, decisoes de aprovacao e sync com Kanban.

## Criterios de Aceite

- [x] Estrutura de armazenamento de auditoria definida e migrada.
- [x] Eventos criticos persistidos com ator, tenant, timestamp e payload minimo.
- [x] Consulta basica de auditoria disponivel para API/UI.
- [x] Testes cobrindo persistencia e leitura da trilha.

## Contexto Tecnico

Nao registrar segredo/credencial em logs de auditoria; manter mascaramento de campos sensiveis.

## Notas de Progresso

### [2026-02-19 00:04] codex
Task criada no planejamento da sprint-029.

### [2026-02-20 18:30] codex
Auditoria operacional validada no `consoleAI` com persistencia de eventos criticos e consulta via API para administradores.
Testes executados:
- `.venv/bin/python -m pytest -q tests/unit/test_consoleai_api.py -k "audit_events_query_for_admin_with_filters or audit_events_query_is_admin_only"` -> 2 passed
- `.venv/bin/python -m pytest -q tests/unit/test_authz.py` -> 9 passed
  - agent: "codex"
    action: "approved_qa"
    date: "2026-02-22T15:50:06-03:00"
- 2026-02-22: QA aprovado. Trilha de auditoria e consultas admin-only validadas por testes unit√°rios focados.
