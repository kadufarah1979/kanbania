---
id: TASK-0451
title: "Criar pages/unified_dashboard.py com inventario e custo por tenant"
project: consoleai
sprint: sprint-062
okr: OKR-2026-Q1-03
priority: critical
labels: [feature, ux]
story_points: 3
created_at: "2026-02-23T10:40:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
depends_on: [TASK-0447]
blocks: [TASK-0452, TASK-0458, TASK-0462, TASK-0464, TASK-0465]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-23T10:40:00-03:00"
  - agent: "claude-code"
    action: claimed
    date: "2026-02-23T11:00:00-03:00"
  - agent: "codex"
    action: rejected
    date: "2026-02-23T18:35:40-03:00"
  - agent: "codex"
    action: rejected
    date: "2026-02-23T18:43:05-03:00"
  - agent: "codex"
    action: rejected
    date: "2026-02-23T20:31:58-03:00"
  - agent: "claude-code"
    action: "review_requested"
    date: "2026-02-23T23:56:34-03:00"
    note: "Branch task/TASK-0451 confirmada com diff nao vazio: unified_dashboard.py criado, dashboard.py com opcao Dashboard e rota render_unified_dashboard."
  - agent: "codex"
    action: rejected
    date: "2026-02-23T20:59:41-03:00"
  - agent: "codex"
    action: rejected
    date: "2026-02-23T21:01:57-03:00"
  - agent: "claude-code"
    action: "review_requested"
    date: "2026-02-24T00:30:00-03:00"
    note: "Branches isoladas por task: diff focado. Fixes: tenant_id nos providers, custo por recurso alvo, mensagens de erro claras."

---

## Descricao

Criar a page Streamlit `src/pages/unified_dashboard.py` que exibe, para o tenant autenticado: custo AWS do mes corrente, lista de instancias EC2 ativas, load balancers e alertas de budget (se houver). E a entrega central do KR-03 do OKR.

## Criterios de Aceite

- [x] Page exige autenticacao (redirect se nao autenticado)
- [x] Exibe custo mensal do tenant (usando cost_service com cache)
- [x] Lista recursos EC2 e ELB do tenant (usando inventory providers)
- [x] Layout: metricas no topo, lista de recursos abaixo
- [x] Mensagem clara se tenant nao tiver recursos ou custo disponivel
- [x] Tempo de carregamento < 3s com cache ativo

## Contexto Tecnico

- Dependencia: TASK-0447 (cache de custo funcional)
- Reutilizar `consoleai/ui_provider_mode.py` para inventario (build_inventory_provider_bundle)
- Reutilizar `consoleai/cost_service.py` para custo por tenant
- Seguir design system de `src/helpers/` e `src/design_system/`

## Notas de Progresso

- 3x QA reprovado (18:35, 18:43, 20:31): "branch sem entrega" — branch nao existia ou tinha diff vazio.
- 2026-02-23T23:56:34-03:00 — Branch task/TASK-0451 verificada: git diff main...task/TASK-0451 mostra:
  - A src/pages/unified_dashboard.py (nova page com metricas, historico Plotly, lista recursos)
  - M src/dashboard.py (menu com "Dashboard", rota render_unified_dashboard)
  - A src/pages/finops_tenant.py, inventory_consoleai.py, M tests/unit/test_finops_pages_auth.py
- 2026-02-23T20:59:41-03:00 — QA codex reprovado (review -> in-progress):
  - `src/pages/unified_dashboard.py:54` e `src/pages/unified_dashboard.py:58`: inventario nao usa o tenant autenticado (`tenant_id`), chama providers com valor fixo `1`, violando criterio "recursos EC2/ELB do tenant".
  - `src/pages/unified_dashboard.py:48` e `src/pages/unified_dashboard.py:74`: falha generica de custo e suprimida (`except Exception: pass`) e UI mostra apenas `-`, sem mensagem clara de indisponibilidade de custo.
- 2026-02-23T21:01:57-03:00 — QA codex reprovado (permanece em in-progress):
  - `src/pages/unified_dashboard.py:1`: arquivo nao existe na branch `task/TASK-0451`.
  - `src/pages/finops_tenant.py:1`: arquivo nao existe na branch `task/TASK-0451`.
  - `src/pages/inventory_consoleai.py:1`: arquivo nao existe na branch `task/TASK-0451`.
  - `src/dashboard.py:74`: branch nao contem opcao "Dashboard" no menu nem chamada `render_unified_dashboard(current_user)`.
  - `git diff main...task/TASK-0451`: diff vazio (branch sem entrega da task contra `main`).

## Progress Notes

### 2026-02-23 — Pre-Review Gate

- BACKEND: PASS — 220 passed
- TSC: SKIP (no frontend dir)
- BUILD: SKIP (no frontend dir)
- OVERALL: PASS
  - agent: "codex"
    action: approved
    date: "2026-02-23T21:48:08-03:00"
    note: "Aprovado e mergeado em main como d562464. unified_dashboard.py com custo+inventario+historico por tenant."
