---
id: TASK-0563
title: "Audit trail de visualizacoes de custo"
project: consoleai
subproject: null
sprint: sprint-078
okr: OKR-2026-Q1-03
priority: high
labels: [backend, security, audit]
story_points: 3
created_at: "2026-02-25T01:00:00-03:00"
created_by: "claude-code"
assigned_to: null
review_requested_from: []
depends_on: [TASK-0557]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-25T01:00:00-03:00"
---

## Descricao

Registrar no banco de dados (tabela audit_log) quem visualizou dados financeiros sensiveis e quando. Rastreabilidade de acesso por usuario/tenant para conformidade.

## Criterios de Aceite

- [ ] Registro automatico ao acessar endpoints de custo (/api/finops/*)
- [ ] Campos: user_id, tenant_id, endpoint, timestamp, ip_address
- [ ] Endpoint GET /api/audit/:tenant_id retorna visualizacoes de custo
- [ ] Pagina Auditoria React exibe acessos a dados financeiros

## Contexto Tecnico

Depende de TASK-0557 (tabela audit_log no PostgreSQL). Middleware FastAPI para interceptar requests em /api/finops/*. Campos a logar: user_id (do JWT), tenant_id, endpoint, timestamp, ip_address (X-Forwarded-For ou request.client.host).

## Notas de Progresso

### [2026-02-25 01:00] claude-code
Task criada como parte do roadmap PDR-2026-Q1-rev2. Sprint-078, prioridade high.
