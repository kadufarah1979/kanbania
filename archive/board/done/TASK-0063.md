---
id: TASK-0063
title: "Q&A schema + migration"
project: aquario
sprint: sprint-009
points: 2
priority: critical
status: done
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0062]
created_at: "2026-02-15T20:00:00-03:00"
created_by: claude-code
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-15T20:00:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-15T21:00:00-03:00"
  - agent: claude-code
    action: moved_to_review
    date: "2026-02-15T21:01:00-03:00"
  - agent: codex
    action: qa_blocked_missing_claude_approved
    date: "2026-02-15T09:18:27-03:00"
  - agent: codex
    action: qa_blocked_missing_claude_approved
    date: "2026-02-15T09:23:28-03:00"
  - agent: codex
    action: qa_blocked_missing_claude_approved
    date: "2026-02-15T09:51:01-03:00"
  - agent: claude-code
    action: approved
    date: "2026-02-15T11:50:00-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-15T11:53:57-03:00"
tokens_used: 2136273
tokens_by_phase:
  backlog: 2089956
  in_progress: 34600
---

## Descricao

Criar tabela listing_questions com migration Alembic.

Tabela listing_questions: id, listing_id, asker_id, question (TEXT), answer (TEXT nullable), answered_at, is_blocked (default false), blocked_reason, created_at.

Index: idx_listing_questions_listing_id on (listing_id, created_at DESC).
FKs: listing_id -> listings(id) CASCADE, asker_id -> users(id) CASCADE.

## Criterios de Aceite

- [x] Migration criada em backend/alembic/versions/
- [x] Tabela listing_questions com todos os campos
- [x] Indices e FKs corretos
- [x] Migration roda sem erros

## Notas de Progresso

- **2026-02-15 21:01 (claude-code)**: Sprint 9 implementation complete. Moved to review.
- **2026-02-15 09:18 (codex)**: QA validou implementacao e gates informados como PASSED, mas bloqueado por regra de processo: card sem `acted_by` de `claude-code` com `action: approved`. Card permanece em `review`.
- **2026-02-15 09:23 (codex)**: QA revalidou implementacao da migration `listing_questions` (campos, FKs e indice conforme card). Resultado de gate recebido foi lock de ambiente (`Could not acquire lock after 5min`), sem indicio de erro de codigo. Card permanece em `review` por ausencia de `acted_by` de `claude-code` com `action: approved`.
- **2026-02-15 09:51 (codex)**: QA revisou novamente a migration `listing_questions` e confirmou critérios técnicos atendidos (campos, FKs CASCADE e índice composto com `created_at DESC`). Gate reportado com lock de ambiente foi tratado como não-bloqueante. Card permanece em `review` por ausência de `acted_by` de `claude-code` com `action: approved`.
- **2026-02-15 11:53 (codex)**: QA: aprovado (gate results: PASSED). Migration `b2c3d4e5f6a7_listing_questions` validada com campos esperados, FKs CASCADE e índice composto `(listing_id, created_at DESC)`.
