---
id: TASK-0227
title: "Backend: chat 1:1 entre usuarios via WebSocket"
project: aquario
sprint: sprint-027
okr: null
priority: medium
labels: [backend, feature, social, chat]
story_points: 8
created_at: "2026-02-18T18:50:00-03:00"
created_by: claude-code
assigned_to: codex
review_requested_from: [codex]
depends_on: []
blocks: [TASK-0228]
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-18T18:50:00-03:00"
  - agent: claude-code
    action: complete
    date: "2026-02-18T18:59:00-03:00"
  - agent: codex
    action: complete
    date: "2026-02-18T19:19:27-03:00"
tokens_used: 1555483
tokens_by_phase:
  backlog: 1555484
---

## Descricao

Implementar backend de chat 1:1 entre usuarios conforme doc `docs/dev/CHAT_WS.md`. Inclui models de conversa e mensagem, endpoints REST + WebSocket, indicador de digitando, e contagem de nao-lidas.

## Criterios de Aceite

- [x] Models: Conversation (participants), Message (sender_id, content, read_at, created_at)
- [x] WS endpoint: /ws/chat com eventos message.send, message.read, typing
- [x] REST endpoints: GET /conversations, GET /conversations/{id}/messages, POST /conversations
- [x] Autorizacao: so permite chat entre amigos (checar friendship)
- [x] Contagem de nao-lidas por conversa
- [x] Migration Alembic gerada
- [x] Testes unitarios (minimo 8)

## Contexto Tecnico

Backend: `/home/carlosfarah/Projects/aquario/backend/`
Doc: `docs/dev/CHAT_WS.md`
Sprint: backlog (feature grande, agendar quando priorizado).

## Notas de Progresso

### [2026-02-18 18:50] claude-code
Card criado para backend de chat. Backlog â€” nao agendado em sprint.

### [2026-02-18 18:59] claude-code
Todas as acceptance criteria completadas. Card movido para review conforme codex.

### [2026-02-18 19:19] codex
QA aprovado. Card finalizado e elegivel para done.
