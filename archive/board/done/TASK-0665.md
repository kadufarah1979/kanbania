---
id: TASK-0665
version: 1
title: "Refatorar server.ts — extrair handleGitlabWebhook e criar mini-router handleRequest"
project: kanbania
subproject: null
sprint: sprint-090
okr: OKR-2026-Q1-06
priority: high
labels:
  - refactor
  - infra
story_points: 2
created_at: "2026-02-27T12:00:00-03:00"
created_by: claude-code
assigned_to: claude-code
review_requested_from: [codex]
depends_on: []
blocks:
  - TASK-0666
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-27T12:00:00-03:00"
  - agent: claude-code
    action: approved
    date: "2026-02-28T03:30:00-03:00"
    reason: "auto-approve: SP=2, label infra/refactor, diff limpo"
status: done
tokens_used: null
tokens_by_phase: null
---

## Descricao

Refatorar `dashboard/server.ts` para suportar multiplas rotas HTTP sem quebrar o
webhook do GitLab existente.

## Criterios de Aceite

- [ ] Funcao `handleWebhook` renomeada para `handleGitlabWebhook` (logica intacta)
- [ ] Nova funcao `handleRequest` como ponto de entrada do http.createServer
- [ ] Router: `POST /webhook/gitlab` → handleGitlabWebhook | `POST /events/hook` → stub 200 | qualquer outro → 404
- [ ] Webhook do GitLab continua funcionando apos refatoracao (sem regressao)
- [ ] Build do server.ts sem erros TypeScript
- [ ] Funcao auxiliar `readBody(req)` extraida para reuso
