---
id: TASK-0127
title: "Teste: livestock-store (Zustand)"
project: aquario
sprint: sprint-016
points: 3
priority: critical
status: review
assigned_to: null
review_requested_from: [codex]
depends_on: []
created_at: "2026-02-16T03:00:00-03:00"
created_by: claude-code
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-16T03:00:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-16T11:00:00-03:00"
  - agent: claude-code
    action: review_requested
    date: "2026-02-16T11:10:00-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-16T11:11:37-03:00"
tokens_used: 1077638
tokens_by_phase:
  backlog: 76582
  in_progress: 1001065
---

## Descricao

Criar `src/__tests__/stores/livestock-store.test.ts` seguindo o padrao de `alert-store.test.ts`.

## Testes Requeridos

- Estado inicial correto (livestock: [], loading: false, error: null, selectedLivestock: null, events: [], growthHistory: [])
- `fetchLivestock`: popula array, seta loading, trata erro
- `addLivestock`: adiciona item ao array
- `updateLivestock`: atualiza item existente, atualiza selectedLivestock se match
- `removeLivestock`: remove item do array
- `setSelectedLivestock`: seta item, limpa events e growthHistory
- `fetchEvents`: popula events array, silently fails on error
- `fetchGrowthHistory`: popula growthHistory array, silently fails on error

## Criterios de Aceite

- [x] Arquivo criado em `src/__tests__/stores/livestock-store.test.ts`
- [x] Mock de `@/lib/api/livestock` com vi.mock()
- [x] Todos os 8+ cenarios testados (15 testes)
- [x] `npm run test` passa (testes do livestock-store: 15/15)

## Notas de Progresso

- 15 testes implementados cobrindo todos os cenarios do card
- Inclui: initial state, fetchLivestock (sucesso + erro + fallback msg), addLivestock, updateLivestock (3 cenarios incl. selectedLivestock sync), removeLivestock, setSelectedLivestock (com/sem null), fetchEvents (sucesso + silent fail), fetchGrowthHistory (sucesso + silent fail)
- 3 falhas pre-existentes em testes nao relacionados (parameter-card, aquarium-create-wizard, reading-form)
