---
id: TASK-0247
title: "Frontend: pagina de outlets com controle de reles"
project: aquario
sprint: sprint-032
okr: OKR-2026-Q1-01
priority: high
labels: [feature, frontend]
story_points: 5
created_at: "2026-02-19T22:30:00-03:00"
created_by: claude-code
assigned_to: codex
review_requested_from: []
depends_on: []
blocks: []
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-19T22:30:00-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-19T11:05:39-03:00"
  - agent: codex
    action: move-to-review
    date: "2026-02-19T11:13:27-03:00"
  - agent: codex
    action: complete
    date: "2026-02-19T12:19:21-03:00"
tokens_used: 1573668
tokens_by_phase:
  in_progress: 1553663
---

## Descricao

O diretorio `frontend/src/app/(authenticated)/outlets/` existe mas esta vazio. Criar a pagina de controle de outlets (tomadas/reles) que permite ao usuario visualizar e acionar os relay channels do aquario. O backend e o relay dashboard component ja existem.

## Criterios de Aceite

- [x] Pagina /outlets renderiza lista de relay channels do aquario selecionado
- [x] Cada outlet exibe: nome, estado atual (on/off), ultimo acionamento
- [x] Botao toggle para ligar/desligar outlet manualmente via API
- [x] Indicador visual de status (online/offline) baseado em availability
- [x] Link para regras de automacao associadas ao channel
- [x] Responsivo (mobile-first)
- [x] Testes unitarios para a pagina (min 3 testes)

## Contexto Tecnico

- API: `backend/app/api/v1/relays.py` (GET channels, POST command)
- Store: `frontend/src/stores/relay-store.ts`
- Reutilizar logica do `RelayChannelDashboard` component
- Pagina dedicada com mais detalhes que o widget na automation page

## Notas de Progresso

### [2026-02-19T11:13:27-03:00] codex
Implementacao concluida da pagina `/outlets` com controle de reles:
- Nova pagina `frontend/src/app/(authenticated)/outlets/page.tsx` com lista de canais, estado ON/OFF, ultimo acionamento e botao de toggle manual.
- Indicador online/offline por outlet baseado em availability do device (`is_online`) via `device-store`.
- Link por outlet para automacao (`/automation`) com contador de regras associadas ao canal.
- Integração WebSocket para refletir mudancas de estado em tempo real no grid de outlets.
- Navegacao atualizada no sidebar principal (`AppSidebar`) para incluir item "Tomadas".
- Ajustes de tipagem de automacao para suportar regras `sensor|schedule` sem regressao de typecheck.
- Testes:
  - `frontend/src/__tests__/pages/outlets-page.test.tsx` (4 testes)
- Evidencias:
  - `npm test -- src/__tests__/pages/outlets-page.test.tsx src/__tests__/pages/automation-page.test.tsx src/__tests__/stores/relay-store.test.ts` => 15 passed.
  - `npx tsc --noEmit` => OK.

### [2026-02-19T12:19:21-03:00] codex
QA gate executado para fechamento Review -> Done.
- Evidencia: npm test -- src/__tests__/pages/outlets-page.test.tsx src/__tests__/pages/automation-page.test.tsx src/__tests__/stores/relay-store.test.ts => 15 passed.
- Evidencia: npx tsc --noEmit => OK.
- Criterios de aceite confirmados para pagina `/outlets` (lista, estado, toggle, availability, link de automacao e responsividade).
