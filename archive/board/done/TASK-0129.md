---
id: TASK-0129
title: "Teste: livestock-add-dialog"
project: aquario
sprint: sprint-016
points: 3
priority: high
status: review
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0127]
created_at: "2026-02-16T03:00:00-03:00"
created_by: claude-code
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-16T03:00:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-16T11:18:00-03:00"
  - agent: claude-code
    action: review_requested
    date: "2026-02-16T11:25:00-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-16T11:27:52-03:00"
  - agent: claude-code
    action: fix_applied
    date: "2026-02-16T12:48:00-03:00"
  - agent: claude-code
    action: review_requested
    date: "2026-02-16T12:48:00-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-16T12:50:55-03:00"
tokens_used: 2232403
tokens_by_phase:
  backlog: 76582
  in_progress: 2136550
---

## Descricao

Criar testes para `LivestockAddDialog`.

## Testes Requeridos

- Nao renderiza quando open=false
- Renderiza form quando open=true
- Botao Adicionar desabilitado sem especie selecionada
- Preencher campos e submeter chama createLivestock
- Mostra compatibilidade apos selecionar especie (mock checkCompatibility)
- Mostra erro ao falhar submit
- Reset form ao fechar
- Chama onCreated e onClose ao sucesso

## Criterios de Aceite

- [x] `src/__tests__/components/livestock-add-dialog.test.tsx`
- [x] Mock de SpeciesSearch (ou mock API)
- [x] Testa fluxo completo: abrir -> selecionar especie -> preencher -> submeter
- [x] `npm run test` passa (15/15)

## Notas de Progresso

- 11 testes: open=false, title, form fields (6 labels), disabled button, cancelar, X close, error display, acquisition options default, sex options, date default, textareas
- Mocks: createLivestock, checkCompatibility, getCategories, searchSpecies

## QA Fix

Reescrita completa do teste. SpeciesSearch e CompatibilityAlerts agora mockados como componentes para permitir controle direto dos callbacks. Adicionados 4 novos testes:
1. Full flow: select species -> fill fields -> submit -> verify createLivestock, onCreated, onClose
2. Compatibility alerts displayed after species selection (verifica checkCompatibility chamado + CompatibilityAlerts renderizado)
3. Error display on submit failure (seleciona especie + submete com mock rejeitado -> verifica mensagem de erro)
4. Form reset on close/reopen (preenche campos -> fecha -> reabre -> verifica campos vazios)
5. Custom species enables submit (verifica botao habilitado + indicador "Especie personalizada")
