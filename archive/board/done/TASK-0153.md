---
id: TASK-0153
title: "Configurar uptime checks e alertas de infra no DigitalOcean"
project: aquario
sprint: sprint-019
okr: OKR-2026-Q1-01
priority: high
labels: [infra, devops, monitoring]
story_points: 3
created_at: "2026-02-17T10:02:00-03:00"
created_by: claude-code
assigned_to: codex
review_requested_from: [codex]
depends_on: []
blocks: []
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-17T10:02:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-17T01:10:00-03:00"
  - agent: claude-code
    action: completed
    date: "2026-02-17T01:45:00-03:00"
  - agent: codex
    action: update
    date: "2026-02-17T00:47:48-03:00"
  - agent: codex
    action: update
    date: "2026-02-17T01:06:14-03:00"
  - agent: claude-code
    action: fix-qa
    date: "2026-02-17T04:30:00-03:00"
  - agent: codex
    action: complete
    date: "2026-02-17T01:23:58-03:00"
tokens_used: 3904077
tokens_by_phase:
  in_progress: 758435
  review: 1884675
---

## Descricao

Configurar monitoramento de infraestrutura no DigitalOcean para o droplet de producao do Aquario, incluindo uptime checks HTTP/HTTPS e alertas de metricas criticas (CPU, memoria, disco). Implementar health endpoints no backend FastAPI para validacao de servicos.

## Criterios de Aceite

- [x] Health endpoint `/health` implementado no backend retornando status
- [x] Health endpoint `/health/live` (liveness) e `/health/ready` (readiness) adicionados
- [x] DigitalOcean Monitoring habilitado no droplet de producao
- [x] Uptime check configurado para `https://aquabook.com.br/api/health`
- [x] Alertas configurados: CPU > 80%, memoria > 85%, disco > 90%
- [x] Notificacoes de alerta enviadas para email do proprietario
- [x] Documentacao em `infrastructure/docs/monitoring.md`

## Notas de Progresso

### [2026-02-17 01:45] claude-code
Implementado:
- `/health` (basic), `/health/live` (liveness), `/health/ready` (readiness com checks de DB, MQTT, heartbeat)
- CORS atualizado com aquabook.com.br
- Uptime check HTTPS criado no DO (c1d91e82)
- 3 alertas de uptime: Site Down (global), High Latency (>3s/5min), SSL Expiry (14d)
- 3 alertas de droplet: CPU >80%, Memory >85%, Disk >90% (todos com janela 10min)
- Notificacoes para carlosfarah@gmail.com
- Commit: 814f57a

### [2026-02-17 04:30] claude-code
Pendencia resolvida: criado `infrastructure/docs/monitoring.md` com documentacao completa de health endpoints, alertas DO, e troubleshooting.

## Pendencias (QA)

### [2026-02-17 00:47] codex
Reprovado no gate de QA: falta cumprir criterio de documentacao em infrastructure/docs/monitoring.md (criterio ainda desmarcado no card). Implementacao de health endpoints validada, mas card nao pode seguir para done sem evidencia documental solicitada.

### [2026-02-17 01:06] codex
Reprovado novamente: card retornou para review sem resolver a pendencia obrigatoria de documentacao em infrastructure/docs/monitoring.md.

### [2026-02-17 04:30] claude-code â€” RESOLVIDO
Documentacao criada em `infrastructure/docs/monitoring.md`. Conteudo: health endpoints (tabela + exemplo JSON), alertas DO configurados (tabela), links para dashboards, troubleshooting.

### [2026-02-17 01:23] codex
QA concluido: criterios e evidencias validados; card aprovado para done.
