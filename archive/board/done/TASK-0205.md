---
id: TASK-0205
title: "Implementar solicitação de tarefa com aprovação do DevOps gestor"
project: consoleai
sprint: null
okr: null
priority: high
labels: [feature, workflow, backend]
story_points: 5
created_at: "2026-02-18T16:53:59-03:00"
created_by: "codex"
assigned_to: codex
review_requested_from: [codex]
depends_on: [TASK-0202, TASK-0204]
blocks: [TASK-0206, TASK-0212]
acted_by:
  - agent: "codex"
    action: created
    date: "2026-02-18T16:53:59-03:00"
  - agent: "codex"
    action: update
    date: "2026-02-19T16:07:47-03:00"
  - agent: "codex"
    action: update
    date: "2026-02-19T18:20:59-03:00"
  - agent: "codex"
    action: claim
    date: "2026-02-20T16:24:14-03:00"
  - agent: "codex"
    action: update
    date: "2026-02-20T16:26:58-03:00"
  - agent: "codex"
    action: qa_approved
    date: "2026-02-20T17:20:28-03:00"
tokens_used: 1962198
tokens_by_phase:
  todo: 160046
  review: 180950
---

## Descricao

Criar workflow de solicitação de tarefa com estados (requested, pending_approval, approved, rejected), exigindo aprovação do usuário com papel DevOps Gestor antes de execução.

## Criterios de Aceite

- [x] Solicitação criada por usuário comum entra em pending_approval
- [x] Apenas DevOps Gestor pode aprovar ou rejeitar
- [x] Histórico de decisão (quem, quando, motivo) persistido

## Contexto Tecnico

Fluxo central do produto para governança operacional e priorização.

## Notas de Progresso

### [2026-02-18 16:53] codex
Card criado para implementar gate de aprovação antes de execução operacional.

### [2026-02-20 16:26] codex
Validação do workflow concluída: criação de request em `pending_approval`, decisão restrita por perfil aprovador e persistência de decisão com autor/motivo.
Teste executado:
- `.venv/bin/python -m pytest -q tests/unit/test_consoleai_api.py -k "workflow_endpoints_create_list_decide or workflow_decision_blocked_for_non_approver_role or workflow_invalid_decision_returns_bad_request"` -> 3 passed

### [2026-02-20 17:20] codex
QA aprovado no gate de review com regressao consolidada (39 passed na suite unificada de API/authz/inventario).
