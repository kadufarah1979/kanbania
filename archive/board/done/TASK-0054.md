---
id: TASK-0054
title: "Marketplace API endpoints"
project: aquario
sprint: sprint-008
okr: OKR-2026-Q1-01
priority: high
labels: [backend, api]
story_points: 3
created_at: "2026-02-15T04:30:00-03:00"
created_by: claude-code
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0053]
blocks: [TASK-0055]
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-15T04:30:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-15T05:00:00-03:00"
  - agent: claude-code
    action: moved_to_review
    date: "2026-02-15T06:00:00-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-15T01:50:48-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-15T01:59:29-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-15T02:11:09-03:00"
  - agent: claude-code
    action: approved
    date: "2026-02-15T15:00:00-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-15T02:26:26-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-15T02:27:26-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-15T02:33:33-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-15T02:38:14-03:00"
tokens_used: 2454208
tokens_by_phase:
  backlog: 2180781
  in_progress: 273465
---

## Descricao

REST endpoints for marketplace listings CRUD.

## Criterios de Aceite

- [ ] POST /api/v1/marketplace/listings — Create
- [ ] GET /api/v1/marketplace/listings — Search with filters + pagination
- [ ] GET /api/v1/marketplace/listings/{id} — Detail
- [ ] PUT /api/v1/marketplace/listings/{id} — Edit (owner only)
- [ ] DELETE /api/v1/marketplace/listings/{id} — Delete (owner only)
- [ ] GET /api/v1/marketplace/listings/me — My listings
- [ ] Router registered in main.py

## Notas de Progresso

- 2026-02-15T01:50:48-03:00 — QA: changes requested
  - BACKEND_GATE: FAILED (2 failed, 125 passed, 12 errors); sem evidência de erro de ambiente/rede.
  - Bug funcional: `GET /api/v1/marketplace/listings` pode retornar 500 para `sort/category/condition` inválidos, pois `ListingSearchParams(...)` é instanciado manualmente sem tratamento de `ValidationError` (`backend/app/api/v1/marketplace.py:121`, `backend/app/api/v1/marketplace.py:135`, `backend/app/schemas/listing.py:124`).
  - Critérios de aceite não podem ser aprovados no gate final até corrigir o erro acima e estabilizar o backend gate.
- 2026-02-15T01:59:29-03:00 — QA: changes requested
  - Revisão manual confirma que a correção de `ValidationError` foi aplicada em `GET /api/v1/marketplace/listings` (`backend/app/api/v1/marketplace.py`), e os endpoints/registro de router exigidos no card existem.
  - BACKEND_GATE atual informado: FAILED com 129 errors em 27.02s; sem evidência de erro de rede/ambiente nos logs fornecidos, então o gate final permanece reprovado.
  - Regra crítica aplicada: sem `acted_by` de `claude-code` com ação `approved`, o card não foi movido de coluna nesta etapa.
- 2026-02-15T02:11:09-03:00 — QA: changes requested
  - Revisão manual confirma que os endpoints do card e o registro de router seguem implementados (`backend/app/api/v1/marketplace.py`, `backend/app/main.py`), incluindo tratamento de `ValidationError` em `GET /api/v1/marketplace/listings`.
  - BACKEND_GATE atual informado: FAILED (2 failed, 88 passed, 112 errors em 40.08s); sem evidência de erro de rede/ambiente no resultado fornecido, então o gate final permanece reprovado até estabilizar os erros.
  - Regra crítica aplicada: sem `acted_by` de `claude-code` com ação `approved`, o card não foi movido de coluna nesta etapa.
- 2026-02-15T02:26:26-03:00 — QA: changes requested
  - Revisão manual mantém conformidade funcional do escopo do card: endpoints CRUD/listagem e registro de router presentes em `backend/app/api/v1/marketplace.py` e `backend/app/main.py`.
  - PRE-REVIEW gate informado: `BACKEND_GATE: FAILED` (`6 failed, 117 passed, 8 errors em 29.03s`), sem evidência de falha de rede/ambiente no relatório fornecido.
  - Gate final permanece reprovado até estabilização do backend gate.
- 2026-02-15T02:27:26-03:00 — QA: changes requested
  - Revisão manual confirma implementação dos endpoints do card e registro do router em `backend/app/api/v1/marketplace.py` e `backend/app/main.py`, incluindo tratamento de `ValidationError` na busca.
  - PRE-REVIEW gate informado: `BACKEND_GATE: FAILED` (`43 passed, 215 errors em 69.40s`), com reset de banco executado e sem evidência de erro de rede/ambiente.
  - Gate final permanece reprovado até estabilização do backend gate.
- 2026-02-15T02:33:33-03:00 — QA: changes requested
  - Revisão manual confirma que os critérios funcionais do card permanecem implementados (`backend/app/api/v1/marketplace.py`, `backend/app/main.py`), sem novo bug funcional evidente no escopo.
  - PRE-REVIEW gate informado nesta rodada: `BACKEND_GATE: FAILED` (`129 errors em 28.22s`), após reset de banco e sem evidência de falha de rede/ambiente.
  - Gate final permanece reprovado até estabilizar o backend gate.
- 2026-02-15T02:38:14-03:00 — QA: aprovado
  - Revisão manual confirma critérios de aceite implementados: CRUD/listagem (`POST/GET/GET{id}/PUT/DELETE`) e `GET /listings/me`, com proteção owner-only em edição/remoção e tratamento de validação na busca (`backend/app/api/v1/marketplace.py`, `backend/app/services/listing_service.py`).
  - Registro de router confirmado em `backend/app/main.py`.
  - Gate results: PASSED (`BACKEND_GATE: 129 passed in 18.25s`).
