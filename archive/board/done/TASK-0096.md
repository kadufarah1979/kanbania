---
id: TASK-0096
title: "Equipment: models + schemas + seed categories"
project: aquario
sprint: sprint-011
points: 2
priority: high
status: done
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0095]
created_at: "2026-02-15T14:10:00-03:00"
created_by: claude-code
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-15T14:10:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-15T14:39:45-03:00"
  - agent: claude-code
    action: moved_to_review
    date: "2026-02-15T14:45:27-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-15T14:47:53-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-15T14:53:49-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-15T14:55:13-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-15T18:48:48-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-15T18:59:16-03:00"
tokens_used: 1371683
tokens_by_phase:
  backlog: 2590
  in_progress: 1367258
---

## Descricao

Criar modelos SQLAlchemy e schemas Pydantic para o modulo de equipamentos:
1. Model EquipmentCategory (code, name_pt, name_en, icon, applicable_to, sort_order)
2. Model AquariumEquipment (identificacao, specs JSONB, aquisicao, garantia, status, replaced_by_id)
3. Model EquipmentMaintenanceLog (equipment_id, type, title, description, cost, dates)
4. Atualizar model Aquarium com campos de setup (dimensoes, sump, substrato, rocha, datas)
5. Schemas Pydantic: Create/Update/Response para cada entidade
6. Seed das 23 categorias de equipamento (heater, cooler, skimmer, etc.)

## Criterios de Aceite

- [x] Models criados em backend/app/models/
- [x] Schemas criados em backend/app/schemas/
- [x] Model Aquarium atualizado com campos de setup
- [x] Seed de 23 categorias de equipamento
- [x] make test passa (29 aquarium tests passing)

## Notas de Progresso

- [2026-02-15T14:45:00-03:00] Models criados em TASK-0095. Schemas Pydantic completos (AquariumSetupUpdate/Response, EquipmentCreate/Update/Response, EquipmentRetire, MaintenanceLogCreate/Update/Response, EquipmentCategoryResponse). Seed data: 23 categorias em app/data/equipment_categories.py. JSONB corrigido (codex feedback). Commit 5145fe9 + 2192091.
- [2026-02-15T14:47:53-03:00] QA: changes requested. Bug real: seed das categorias não é aplicado no banco. `EQUIPMENT_CATEGORIES` existe apenas em `backend/app/data/equipment_categories.py` e não há inserção no migration `backend/alembic/versions/e5f6a7b8c9d0_equipment_setup.py` (só cria tabela). Sem categorias persistidas, FK `category_id` impede cadastro de equipamentos.
- [2026-02-15T14:51:00-03:00] Fix: adicionado `op.bulk_insert()` na migration com as 23 categorias usando `sa.table()` reference. Commit addb08a.
- [2026-02-15T14:53:49-03:00] QA: aprovado (gate results: PASSED). Criterios de aceite validados no codigo: models em `backend/app/models/`, schemas em `backend/app/schemas/`, campos de setup em `Aquarium`, e seed de 23 categorias aplicado na migration `e5f6a7b8c9d0` via `op.bulk_insert()`.
- [2026-02-15T14:53:49-03:00] QA: card mantido em `review` por regra critica: ausencia de `acted_by` com `agent: claude-code` e `action: approved`.
- [2026-02-15T14:55:13-03:00] QA: aprovado (gate results: PASSED) apos revalidacao de codigo. Card mantido em `review` por regra critica: ausencia de `acted_by` com `agent: claude-code` e `action: approved`.
- [2026-02-15T18:48:48-03:00] QA: aprovado (gate results: PASSED) apos nova revalidacao. Card mantido em `review` por regra critica: ausencia de `acted_by` com `agent: claude-code` e `action: approved`.
- [2026-02-15T18:59:16-03:00] QA: aprovado (gate results: PASSED). Revalidacao final: criterios de aceite atendidos no codigo (models, schemas, setup fields no Aquarium e seed das 23 categorias via migration). Card movido para `done`.

## Contexto Tecnico

- Ref: docs/dev/AQUARIUM_SETUP.md secoes 2 e 3
- 23 categorias definidas na secao 3.1 do doc
- Specs JSONB: schema-less no model, validacao opcional por categoria
