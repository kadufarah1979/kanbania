---
id: TASK-0231
title: "Criar camada API FastAPI para tenants, usuarios, workflow e inventario"
project: consoleai
sprint: sprint-029
okr: null
priority: critical
labels: [backend, api, feature]
story_points: 5
created_at: "2026-02-19T00:04:11-03:00"
created_by: codex
assigned_to: codex
review_requested_from: [codex]
depends_on: []
blocks: [TASK-0232, TASK-0236]
acted_by:
  - agent: codex
    action: created
    date: "2026-02-19T00:04:11-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-19T00:09:55-03:00"
  - agent: codex
    action: release
    date: "2026-02-19T16:49:13-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-19T18:50:07-03:00"
  - agent: codex
    action: update
    date: "2026-02-19T19:10:18-03:00"
  - agent: codex
    action: move
    date: "2026-02-19T19:10:18-03:00"
  - agent: codex
    action: move
    date: "2026-02-19T20:38:30-03:00"
tokens_used: 2435323
tokens_by_phase:
  backlog: 1555810
  in_progress: 61653
  review: 130692
---

## Descricao

Implementar camada HTTP com FastAPI para expor os casos de uso atuais do ConsoleAI: usuarios, workflow de solicitacoes e inventario por tenant.

## Criterios de Aceite

- [x] Aplicacao FastAPI criada com roteamento versionado (`/api/v1`).
- [x] Endpoints de usuarios, workflow e inventario implementados com contratos consistentes.
- [x] Mapeamento de erros de dominio para codigos HTTP padronizados.
- [x] Testes automatizados de API cobrindo casos felizes e erros comuns.

## Contexto Tecnico

Basear-se nos servicos existentes em `src/consoleai/*_service.py` e manter compatibilidade com backend PostgreSQL.

## Notas de Progresso

### [2026-02-19 00:04] codex
Task criada no planejamento da sprint-029.

### [2026-02-19 19:10] codex
Entrega da camada API FastAPI concluída:
- adicionados serviços `src/consoleai/user_service.py`, `src/consoleai/workflow_service.py` e `src/consoleai/inventory_service.py`;
- adicionada aplicação versionada em `src/consoleai/api.py` com rotas `/api/v1/users`, `/api/v1/workflow/*` e `/api/v1/inventory/*`;
- implementado mapeamento de erros de domínio para HTTP 400/403/404/409;
- adicionados testes `tests/unit/test_consoleai_api.py` cobrindo casos felizes e erros comuns;
- validação executada com `.venv/bin/python -m pytest -q tests/unit/test_authz.py tests/unit/test_scheduler.py tests/unit/test_consoleai_api.py` (34 passed).

### [2026-02-19 20:38] codex
Gate de QA concluido para TASK-0231:
- validacao independente no repositorio `/home/carlosfarah/Projects/consoleai`;
- comando executado: `PYTHONPATH=src .venv/bin/python -m pytest -q tests/test_api.py tests/test_authz.py tests/test_inventory_service.py tests/test_user_service.py`;
- resultado: `27 passed`.
Observacao: caminhos antigos `tests/unit/...` no card estao desatualizados para a estrutura atual de testes.
Card aprovado e movido de `review` para `done`.
