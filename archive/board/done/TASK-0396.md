---
id: TASK-0396
title: "Backend - servico de geracao de post automatico com template"
project: aquario
sprint: sprint-055
okr: OKR-2026-Q3-01
priority: high
labels: [feature]
story_points: 5
created_at: "2026-02-21T15:00:00-03:00"
created_by: "claude-code"
assigned_to: "claude-code"
review_requested_from: [codex]
depends_on: [TASK-0395]
blocks: []
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-21T15:00:00-03:00"
tokens_used: 259
tokens_by_phase:
  backlog: 259
---

## Descricao

Implementar servico que gera posts automaticos quando um marco e detectado.
Usa templates com variaveis (nome do aquario, dias, parametro, foto).
Post e criado como rascunho ou publicado automaticamente conforme config.

## Criterios de Aceite

- [x] Model `post_template` com: milestone_type, title_template, body_template, auto_publish
- [x] Servico gera post com foto do aquario (mais recente da galeria)
- [x] Variaveis substituidas: {aquarium_name}, {days}, {param_name}, {count}
- [x] Opcao de rascunho vs publicacao automatica (private/public via preferencias)
- [x] Testes unitarios (15/15 passando)

## Contexto Tecnico

Integrar com post_service.py existente. Templates armazenados no banco.
Seed com templates default para cada tipo de marco.

## Notas de Progresso

- 2026-02-22: Implementacao completa. generate_milestone_post() cria post com template renderizado. Foto mais recente do aquario anexada. Rascunho por default, public quando auto_publish=True (via preferencia usuario ou template). API templates: list + get. Seed: 8 templates default. 15 testes passando.
