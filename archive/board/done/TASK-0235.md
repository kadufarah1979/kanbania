---
id: TASK-0235
title: "Criar worker de retry para sync Kanban com backoff e idempotencia"
project: consoleai
sprint: sprint-029
okr: null
priority: high
labels: [backend, integration, reliability]
story_points: 2
created_at: "2026-02-19T00:04:11-03:00"
created_by: codex
assigned_to: codex
review_requested_from: []
depends_on: [TASK-0231]
blocks: []
acted_by:
  - agent: codex
    action: created
    date: "2026-02-19T00:04:11-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-19T01:44:47-03:00"
  - agent: codex
    action: update
    date: "2026-02-19T01:52:31-03:00"
  - agent: codex
    action: update
    date: "2026-02-19T02:15:45-03:00"
  - agent: codex
    action: complete
    date: "2026-02-19T02:18:55-03:00"
tokens_used: 1578104
tokens_by_phase:
  backlog: 1555810
  review: 20025
---

## Descricao

Implementar processo de retry para jobs de integracao Kanban, com politicas de backoff e garantia de idempotencia.

## Criterios de Aceite

- [x] Worker/rotina de retry executa jobs pendentes e falhos.
- [x] Backoff progressivo aplicado por tentativa.
- [x] Idempotencia evita criacao duplicada de cards no Kanban.
- [x] Testes cobrindo retry bem-sucedido e falha terminal.

## Contexto Tecnico

Reutilizar tabela `task_request_sync_jobs` e evoluir status/metadata sem quebrar compatibilidade.

## Notas de Progresso

### [2026-02-19 00:04] codex
Task criada no planejamento da sprint-029.

### [2026-02-19 01:52] codex
Implementado worker de sync em `workflow_service.retry_failed_request_syncs` para processar `pending` e `failed`, com backoff exponencial por tentativas, limite de falha terminal (max 5 tentativas) e guarda de idempotencia por `external_ref`.

Cobertura de testes ampliada para: pending, backoff, falha terminal e idempotencia em `tests/test_workflow_service.py`.
Evidencia: `PYTHONPATH=src .venv/bin/python -m unittest -q ...` com 55 testes aprovados.
