---
id: TASK-0256
title: "Auditar arquivos IaC do stage prd"
project: onmidia
sprint: sprint-034
okr: null
priority: high
labels: [infra, security]
story_points: 5
created_at: "2026-02-19T14:38:42-03:00"
created_by: "claude-code"
assigned_to: claude-code
review_requested_from: []
depends_on: []
blocks: [TASK-0258]
acted_by:
  - agent: "claude-code"
    action: created
    date: "2026-02-19T14:38:42-03:00"
tokens_used: 1571091
tokens_by_phase:
  backlog: 1553137
---

## Descricao

Revisar todos os arquivos .tf em `IaC/stage/prd/` para identificar problemas de configuracao, seguranca e boas praticas. Focar em:

- Configuracoes de CORS (ALB, API Gateway, S3 bucket policies, CloudFront)
- Security groups (regras permissivas, portas abertas desnecessariamente)
- IAM policies (principio de menor privilegio)
- Networking (VPC, subnets, NAT Gateway, EIPs)
- SSL/TLS e certificados ACM
- Route53 (DNS, health checks)
- Secrets Manager (segredos expostos ou hardcoded)
- Launch templates e ASG (configuracoes de instancia)
- IoT policies e topic rules

NAO analisar codigo-fonte do projeto (backend/frontend). Apenas IaC.

## Criterios de Aceite

- [ ] Todos os arquivos .tf em IaC/stage/prd/ foram revisados
- [ ] Problemas de CORS identificados e documentados
- [ ] Security groups auditados para regras permissivas
- [ ] IAM policies verificadas quanto ao principio de menor privilegio
- [ ] Configuracoes de rede (VPC/subnets/NGW) validadas
- [ ] Certificados e DNS revisados
- [ ] Achados registrados com severidade (critico/alto/medio/baixo)

## Contexto Tecnico

- Diretorio: `IaC/stage/prd/`
- Arquivos: backend.tf, data.tf, iot_policies.tf, iot_topic_rules.tf, locals_acm.tf, locals_asg.tf, locals_ec2.tf, locals_eip.tf, locals_iam.tf, locals_iot.tf, locals_launch_template.tf, locals_load_balancer.tf, locals_ngw.tf, locals_route53.tf, locals_s3.tf, locals_secrets_manager.tf, locals_security_group.tf, modules.tf, outputs.tf, provider.tf, terraform.tfvars, variables.tf
- Modulos compartilhados em `IaC/modules/`
- Common em `IaC/stage/common/`
- Restricao: nao analisar codigo-fonte (backend/, frontend/, Mobile/)

## Notas de Progresso

- 2026-02-19: Auditoria completa de todos os 21 arquivos .tf em IaC/stage/prd/, modulos e common. 37 findings identificados (6 critico, 11 alto, 12 medio, 8 baixo). Documento gerado em docs/audit-prd-2026-02-19.md.
