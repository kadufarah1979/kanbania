---
id: TASK-0219
title: "Implementar inventário de instâncias EC2 e ação de restart com bloqueio PRD"
project: consoleai
sprint: sprint-026
okr: null
priority: critical
labels: [feature, aws, ec2, security]
story_points: 2
created_at: "2026-02-18T17:02:00-03:00"
created_by: codex
assigned_to: codex
review_requested_from: []
depends_on: [TASK-0214]
blocks: []
acted_by:
  - agent: codex
    action: created
    date: "2026-02-18T17:02:00-03:00"
  - agent: codex
    action: claimed
    date: "2026-02-18T17:54:21-03:00"
  - agent: codex
    action: update
    date: "2026-02-18T18:28:32-03:00"
  - agent: codex
    action: update
    date: "2026-02-18T18:41:30-03:00"
  - agent: codex
    action: update
    date: "2026-02-18T18:45:53-03:00"
  - agent: codex
    action: update
    date: "2026-02-18T18:53:10-03:00"
  - agent: codex
    action: update
    date: "2026-02-18T18:45:53-03:00"
tokens_used: 1726163
tokens_by_phase:
  backlog: 173026
  in_progress: 1553137
---

## Descricao

Implementar listagem de instâncias por tenant (status e tipo) e ação de restart para ambientes não-PRD com confirmação obrigatória.

## Criterios de Aceite

- [x] Listagem de instâncias mostra status e tipo
- [x] Restart disponível apenas para perfis autorizados
- [x] Restart em PRD sempre bloqueado no backend

## Contexto Tecnico

Entrega visibilidade de compute e ação operacional controlada.

## Notas de Progresso

### [2026-02-18 18:41] codex
QA reprovado e task devolvida para in-progress.

### [2026-02-18 18:45] codex
Ajustes de QA implementados:
- `ec2_service.py`: `AwsEc2Provider` alterado para cliente tenant-scoped via `client_factory(tenant_id)`.
- `restart_ec2_instance`: valida pertença da instância ao tenant antes de executar reboot (`instance_out_of_tenant_scope`).
- teste adicional cobrindo bloqueio de restart fora do escopo do tenant.

### [2026-02-18 18:45] codex
Risco residual de paginação eliminado:
- paginação por `NextToken` implementada para `describe_instances` no provider EC2.

### [2026-02-18 18:53] codex
Task aprovada no gate de review após fechamento dos riscos críticos.
