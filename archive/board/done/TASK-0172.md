---
id: TASK-0172
title: "Frontend: UI de automacao (regras, historico, controle manual de reles)"
project: aquario
sprint: null
okr: OKR-2026-Q1-01
priority: medium
labels: [frontend, feature, automation]
story_points: 5
created_at: "2026-02-18T00:00:00-03:00"
created_by: claude-code
assigned_to: codex
review_requested_from: [codex]
depends_on: []
blocks: []
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-18T00:00:00-03:00"
  - agent: codex
    action: complete
    date: "2026-02-18T19:57:48-03:00"
tokens_used: 4831032
tokens_by_phase:
  in_progress: 25678
  review: 2038215
---

## Descricao

Criar UI no frontend para gerenciar regras de automacao e controlar reles manualmente. Pagina /automation com 3 tabs: regras (CRUD + toggle), historico de eventos e controle manual de reles.

## Criterios de Aceite

- [x] API client `lib/api/automation.ts` com CRUD de regras, eventos, toggle e relay command
- [x] Zustand store `stores/automation-store.ts` com state e actions
- [x] Pagina /automation com 3 tabs: Regras, Historico, Controle Manual
- [x] Tab Regras: lista com nome, condicao, acao, status, toggle inline, editar, excluir
- [x] Tab Historico: eventos paginados com filtro de periodo
- [x] Tab Controle Manual: cards por dispositivo relay com toggles por canal
- [x] Dialog de criacao/edicao de regra (`automation-rule-form.tsx`)
- [x] Card de controle de rele (`relay-control-card.tsx`)
- [x] Item "Automacao" na sidebar com icon Zap
- [x] Handler WS `onAutomation` em `use-aquarium-ws.ts` para atualizacao em tempo real
- [x] Build TS sem erros

## Contexto Tecnico

Frontend: `/home/carlosfarah/Projects/aquario/frontend/`
Backend: endpoints CRUD em `/api/v1/aquariums/{id}/automation-rules`, toggle em `/api/v1/automation-rules/{id}/toggle`, relay em `/api/v1/devices/{id}/relay/{ch}/command`.

## Notas de Progresso

### [2026-02-18] claude-code
Implementacao completa verificada. Todos os arquivos do plano ja existem e o build passa sem erros. Arquivos:
- `frontend/src/lib/api/automation.ts`: API client com getAutomationRules, createAutomationRule, updateAutomationRule, deleteAutomationRule, toggleAutomationRule, getAutomationEvents, sendRelayCommand + tipos
- `frontend/src/stores/automation-store.ts`: Zustand store com rules, events, loading, error + actions CRUD/toggle/fetchEvents
- `frontend/src/app/(authenticated)/automation/page.tsx`: Pagina com 3 tabs (rules/history/manual), CRUD inline, toggle, filtro de periodo, paginacao, controle manual de reles, integracao WS
- `frontend/src/components/automation/automation-rule-form.tsx`: Dialog de criacao/edicao com campos: name, sensor_parameter, operator, threshold, target_device_id, target_channel, action, cooldown_minutes
- `frontend/src/components/automation/relay-control-card.tsx`: Card de controle manual por dispositivo relay
- `frontend/src/hooks/use-aquarium-ws.ts`: Handler onAutomation para atualizacao em tempo real de estados de rele
- `frontend/src/__tests__/pages/automation-page.test.tsx`: Testes da pagina
- Sidebar: item "Automacao" com icon Zap na secao Monitoramento
- Build TS OK (pagina /automation renderiza como static)

### [2026-02-18 19:57] codex
QA aprovado. Validado coverage dos criterios no codigo e teste da pagina de automacao passou (4/4). Card finalizado e movido para done.
