---
id: TASK-0128
title: "Teste: species-search + compatibility-alerts"
project: aquario
sprint: sprint-016
points: 3
priority: high
status: done
assigned_to: null
review_requested_from: [codex]
depends_on: [TASK-0127]
created_at: "2026-02-16T03:00:00-03:00"
created_by: claude-code
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-16T03:00:00-03:00"
  - agent: claude-code
    action: claimed
    date: "2026-02-16T11:10:00-03:00"
  - agent: claude-code
    action: review_requested
    date: "2026-02-16T11:15:00-03:00"
  - agent: codex
    action: qa_changes_requested
    date: "2026-02-16T11:16:03-03:00"
  - agent: claude-code
    action: fix_applied
    date: "2026-02-16T11:25:00-03:00"
  - agent: claude-code
    action: review_requested
    date: "2026-02-16T11:25:00-03:00"
  - agent: codex
    action: qa_approved
    date: "2026-02-16T11:28:39-03:00"
tokens_used: 154310
tokens_by_phase:
  backlog: 76582
  in_progress: 77731
---

## Descricao

Criar testes para `SpeciesSearch` e `CompatibilityAlerts`.

## Testes Requeridos — SpeciesSearch

- Renderiza input de busca e dropdown de categorias
- Chama searchSpecies apos debounce (mockar timers)
- Exibe resultados com nome comum, cientifico e categoria
- Selecionar especie chama onSelect
- "Usar como nome personalizado" chama onCustomSpecies
- Fecha dropdown ao clicar fora

## Testes Requeridos — CompatibilityAlerts

- Renderiza mensagem verde quando overall_level="compatible" e sem warnings
- Renderiza warnings amarelos para "caution"
- Renderiza warnings vermelhos para "incompatible"/"dangerous"
- Mostra alerta de tanque quando tank_size_ok=false
- Mostra alerta de parametros quando params_ok=false

## Criterios de Aceite

- [x] `src/__tests__/components/species-search.test.tsx` (11 testes)
- [x] `src/__tests__/components/compatibility-alerts.test.tsx` (8 testes)
- [x] Mocks de API e timers (vi.useFakeTimers, vi.mock)
- [x] `npm run test` passa (19/19)

## Notas de Progresso

- SpeciesSearch: 11 testes — input, label, categories dropdown, debounce search, no search < 2 chars, results display, onSelect, custom species, onCustomSpecies, closes dropdown on outside click, category change triggers search
- CompatibilityAlerts: 8 testes — compatible, caution, incompatible, dangerous, multiple warnings, tank_size_ok=false, params_ok=false, no extra warnings when ok

## QA Fix

- Adicionado teste "closes dropdown when clicking outside" que renderiza botao externo, abre dropdown via busca, clica fora, e verifica que dropdown fecha. Corrige feedback do codex sobre cenario obrigatorio faltante.
