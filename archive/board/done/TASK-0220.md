---
id: TASK-0220
title: "Backend: sistema de manutencao e rotinas (TPA, alimentacao, midias)"
project: aquario
sprint: sprint-027
okr: OKR-2026-Q1-01
priority: high
labels: [backend, feature, maintenance]
story_points: 5
created_at: "2026-02-18T23:50:00-03:00"
created_by: claude-code
assigned_to: codex
review_requested_from: [codex]
depends_on: []
blocks: [TASK-0221]
acted_by:
  - agent: claude-code
    action: created
    date: "2026-02-18T23:50:00-03:00"
  - agent: claude-code
    action: move
    date: "2026-02-18T00:00:00-03:00"
  - agent: codex
    action: update
    date: "2026-02-18T18:28:32-03:00"
  - agent: codex
    action: comment
    date: "2026-02-18T18:51:25-03:00"
  - agent: codex
    action: complete
    date: "2026-02-18T18:53:56-03:00"
tokens_used: 1555483
tokens_by_phase:
  backlog: 68202
---

## Descricao

Implementar backend de rastreamento de rotinas de manutencao conforme doc `docs/dev/MAINTENANCE_AND_ROUTINES.md`. Inclui TPA (troca parcial de agua), controle de midias filtrantes, e registro de alimentacao.

## Criterios de Aceite

- [x] Model WaterChange (TPA) com campos: volume_liters, salinity_before/after, temperature_before/after, notes, performed_at
- [x] Model MaintenanceLog generico para midias filtrantes e outras atividades
- [x] Endpoints CRUD: POST/GET /aquariums/{id}/water-changes, POST/GET /aquariums/{id}/maintenance-logs
- [x] Migration Alembic gerada
- [x] Testes unitarios (minimo 6)

## Contexto Tecnico

Backend: `/home/carlosfarah/Projects/aquario/backend/`
Doc: `docs/dev/MAINTENANCE_AND_ROUTINES.md`
Seguir padrao de `alert_rules` (model + schema + service + router).

## Notas de Progresso

### [2026-02-18 23:50] claude-code
Card criado para backend de manutencao.

### [2026-02-18 18:51] codex
Checklist de QA realizado por inspeção técnica:
- Modelos confirmados: `water_changes` e `maintenance_logs`.
- Rotas confirmadas: POST/GET/GET-by-id/PUT de `water-changes` e POST/GET de `maintenance-logs`.
- Migração confirmada: `04763481cb12_add_water_changes_and_maintenance_logs.py`.
- Cobertura de testes existente: 8 testes em `backend/tests/test_maintenance.py` (>= 6).
- Verificação de sintaxe do backend: `python -m compileall -q app` OK.

Limite do ambiente nesta sessão:
- Não foi possível executar `pytest` porque não está instalado na `.venv`.
- Instalação de dependências de teste falhou por indisponibilidade de rede (sem acesso ao índice do pip).

Gate de review:
- Aprovado para `done` com ressalva operacional registrada acima.
